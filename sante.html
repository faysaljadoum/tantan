<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <title>Santé - Province de Tan-Tan</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        /* Animation du spinner de chargement */
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Cache l'écran par défaut via JS, mais on définit l'affichage flex ici */
        #loading-screen {
            display: none !important;
            /* Sera forcé à 'flex' par le JS */
        }

        :root {
            --primary: #e11d48;
            /* Rose 600 */
            --primary-dark: #9f1239;
            --accent: #fb7185;
            /* Rose 400 */
            --glass: rgba(255, 255, 255, 0.8);
            --glass-strong: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.5);
            --shadow-wow: 0 25px 50px -12px rgba(225, 29, 72, 0.15);
            --glow-color: rgba(251, 113, 133, 0.4);
            --color-urbain: #e11d48;
            --color-rural: #fb7185;
            --alert-red: #be123c;
            --bar-commune: #e11d48;
            --bar-region: #fb7185;
            --bar-national: #94a3b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #f1f5f9;
            color: #0f172a;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Master Background --- */
        .bg-master {
            position: fixed;
            inset: 0;
            background: url('img/sahara_maroc.jpeg') center/cover no-repeat;
            z-index: -1;
            filter: saturate(0.9) brightness(1);
            animation: bgPan 80s infinite alternate linear;
        }

        .bg-overlay {
            position: fixed;
            inset: 0;
            background: rgba(241, 245, 249, 0.88);
            backdrop-filter: blur(12px);
            z-index: -1;
        }

        @keyframes bgPan {
            from {
                transform: scale(1);
            }

            to {
                transform: scale(1.15) translate(-2%, -1%);
            }
        }

        /* Animation fluide pour les barres (ex: Dialyse) */
        .c-bar {
            transition: width 1.5s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
            position: relative;
            overflow: hidden;
        }

        .c-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.2), transparent);
        }

        /* Animation des indicateurs circulaires et icônes */
        .ui-card,
        .diag-card {
            opacity: 0;
            transform: translateY(20px);
            animation: slideInUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        /* Effet de cascade pour les listes d'indicateurs */
        .indicator-row {
            opacity: 0;
            transform: translateX(-15px);
            animation: slideInRight 0.5s ease-out forwards;
        }

        @keyframes slideInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Interaction au survol */
        .diag-card:hover {
            transform: scale(1.02) translateX(5px);
            box-shadow: 0 10px 20px rgba(225, 29, 72, 0.1);
            border-left: 5px solid var(--primary);
        }

        /* --- STAGGERED ENTRANCE SYSTEM --- */
        .stagger-item {
            opacity: 0;
            transform: translateY(30px);
            animation: staggerIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes staggerIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Generate delays for up to 12 items */
        .stagger-item:nth-child(1) {
            animation-delay: 0.1s;
        }

        .stagger-item:nth-child(2) {
            animation-delay: 0.2s;
        }

        .stagger-item:nth-child(3) {
            animation-delay: 0.3s;
        }

        .stagger-item:nth-child(4) {
            animation-delay: 0.4s;
        }

        .stagger-item:nth-child(5) {
            animation-delay: 0.5s;
        }

        .stagger-item:nth-child(6) {
            animation-delay: 0.6s;
        }

        .stagger-item:nth-child(7) {
            animation-delay: 0.7s;
        }

        .stagger-item:nth-child(8) {
            animation-delay: 0.8s;
        }

        .stagger-item:nth-child(9) {
            animation-delay: 0.9s;
        }

        .stagger-item:nth-child(10) {
            animation-delay: 1.0s;
        }

        .stagger-item:nth-child(11) {
            animation-delay: 1.1s;
        }

        .stagger-item:nth-child(12) {
            animation-delay: 1.2s;
        }

        /* --- Premium Header --- */
        header {
            padding: 15px 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            position: relative;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 2px solid rgba(30, 58, 138, 0.1);
            z-index: 2000;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.05);
            animation: slideDown 1.2s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .header-center {
            text-align: center;
        }

        .pdti-subtitle {
            font-size: 1.1rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--primary));
            background-size: 200% auto;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shineText 4s linear infinite;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }

        @keyframes shineText {
            to {
                background-position: 200% center;
            }
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .maroc-separator {
            display: flex;
            align-items: center;
            gap: 20px;
            justify-content: center;
        }

        .province-text {
            font-weight: 900;
            text-transform: uppercase;
            font-size: 1.3rem;
            color: #881337;
            letter-spacing: 3px;
        }

        .line {
            height: 2px;
            background: linear-gradient(to right, transparent, var(--accent), transparent);
            flex: 1;
            width: 100px;
            opacity: 0.6;
        }

        .logo-box {
            width: 75px;
            height: 75px;
            background: rgba(225, 29, 72, 0.1);
            border: 2px solid rgba(225, 29, 72, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 8px 20px rgba(225, 29, 72, 0.1);
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
            z-index: 2;
        }

        .logo-box:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 15px 30px rgba(251, 113, 133, 0.3);
            background: rgba(255, 255, 255, 1);
        }

        .logo-box img {
            width: 75%;
            height: auto;
            object-fit: contain;
        }

        .header-actions {
            position: absolute;
            right: 40px;
            display: flex;
            gap: 15px;
        }

        .btn-premium {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            border: none;
            font-weight: 700;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(159, 18, 57, 0.2);
        }

        .btn-premium:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(225, 29, 72, 0.3);
            background: #be123c;
        }

        /* --- Layout --- */
        .middle-container {
            flex: 1;
            display: flex;
            padding: 20px 30px;
            gap: 20px;
            overflow: hidden;
            position: relative;
        }

        .side-panel {
            width: 380px;
            position: relative;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 25px 20px;
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(25px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 35px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1), inset 0 0 20px rgba(255, 255, 255, 0.5);
            overflow-y: auto;
            scrollbar-width: none;
            animation: slideInLeft 1s cubic-bezier(0.16, 1, 0.3, 1) backwards;
        }

        .side-panel.panel-right {
            animation: slideInRight 1s cubic-bezier(0.16, 1, 0.3, 1) backwards;
        }

        @keyframes slideInLeft {
            from {
                transform: translateX(-100px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .side-panel::-webkit-scrollbar {
            display: none;
        }

        #map-container {
            flex-grow: 1;
            position: relative;
            border-radius: 35px;
            overflow: hidden;
            box-shadow: var(--shadow-wow);
            border: 1px solid var(--glass-border);
            background: white;
        }

        #map-detail {
            width: 100%;
            height: 100%;
            transition: filter 0.5s ease;
        }

        /* --- Cards & UI --- */
        .ui-card {
            background: white;
            border-radius: 24px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(225, 29, 72, 0.05);
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            cursor: pointer;
            margin-bottom: 10px;
        }

        .ui-card:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: 0 20px 40px rgba(225, 29, 72, 0.12);
            border-color: var(--accent);
        }

        .card-profile-header {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            padding: 15px;
            margin: -10px auto 25px auto;
            width: 90%;
            border-radius: 50px;
            font-weight: 900;
            font-size: 0.85rem;
            text-transform: uppercase;
            color: white;
            text-align: center;
            box-shadow: 0 10px 20px rgba(225, 29, 72, 0.2);
        }

        .indicator-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            animation: fadeInRight 0.5s ease backwards;
        }

        @keyframes fadeInRight {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .indicator-icon {
            width: 45px;
            height: 45px;
            background: #fff1f2;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.2rem;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .indicator-label {
            font-size: 0.95rem;
            font-weight: 800;
            color: #1a365d;
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
        }

        .data-table td {
            background: rgba(255, 255, 255, 0.5);
            padding: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .data-table td:first-child {
            border-radius: 12px 0 0 12px;
            color: #64748b;
        }

        .data-table td:last-child {
            border-radius: 0 12px 12px 0;
            text-align: right;
            color: var(--primary);
            font-weight: 800;
        }

        /* --- Filters --- */
        .filter-container-left {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn-filter-left {
            flex: 1;
            background: white;
            border: 1px solid var(--glass-border);
            padding: 15px;
            border-radius: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
        }

        .btn-filter-left:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.05);
            border-color: var(--accent);
        }

        .filter-row {
            display: flex;
            gap: 10px;
        }

        .btn-commune-urbaine {
            flex: 1;
            background: white;
            border: 1.5px solid var(--primary);
            color: var(--primary);
            padding: 12px 15px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.7rem;
            font-weight: 900;
            text-transform: uppercase;
            transition: all 0.3s;
            text-align: center;
        }

        .btn-commune-urbaine:hover,
        .btn-commune-urbaine.active {
            background: var(--primary);
            color: white;
        }

        /* --- Navigation --- */
        .bottom-nav {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            display: flex;
            gap: 15px;
            background: rgba(226, 232, 240, 0.85);
            backdrop-filter: blur(20px);
            padding: 12px 30px;
            border-radius: 100px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.8);
            animation: slideUpNav 1.2s cubic-bezier(0.16, 1, 0.3, 1) 0.6s backwards;
        }

        @keyframes slideUpNav {
            from {
                transform: translate(-50%, 100px);
                opacity: 0;
            }

            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }

        .nav-btn {
            text-decoration: none;
            color: #334155;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 10px 20px;
            border-radius: 50px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            animation: navBtnEntrance 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes navBtnEntrance {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .nav-btn:nth-child(1) {
            animation-delay: 0.1s;
        }

        .nav-btn:nth-child(2) {
            animation-delay: 0.2s;
        }

        .nav-btn:nth-child(3) {
            animation-delay: 0.3s;
        }

        .nav-btn:nth-child(4) {
            animation-delay: 0.4s;
        }

        .nav-btn:nth-child(5) {
            animation-delay: 0.5s;
        }

        .nav-btn i {
            font-size: 1.1rem;
            color: #57595a;
            transition: transform 0.3s;
        }

        .nav-btn:hover i {
            transform: scale(1.2) rotate(10deg);
        }

        .nav-btn.active i,
        .nav-btn:hover,
        .nav-btn.active {
            background: rgba(225, 29, 72, 0.12);
            color: var(--primary-dark);
            transform: translateY(-2px);

        }



        @keyframes activePillPulse {
            0% {
                box-shadow: 0 5px 15px rgba(225, 29, 72, 0.2);
            }

            50% {
                box-shadow: 0 8px 25px rgba(225, 29, 72, 0.4);
            }

            100% {
                box-shadow: 0 5px 15px rgba(225, 29, 72, 0.2);
            }
        }

        /* --- Map Overlay & Isolation --- */
        #map-overlay {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0);
            pointer-events: none;
            z-index: 500;
            transition: 0.4s;
            border-radius: 35px;
        }

        #map-overlay.active {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(15px);
            pointer-events: auto;
        }

        #isolated-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 80%;
            height: 80%;
            z-index: 600;
            pointer-events: none;
            opacity: 0;
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        #isolated-box.active {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        #isolated-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.2));
        }

        .pop-active {
            animation: communePopOut 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes communePopOut {
            0% {
                transform: translate(0, 0) scale(1);
                filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.2));
            }

            100% {
                transform: translate(-15px, -15px) scale(1.08);
                filter: drop-shadow(20px 20px 30px rgba(0, 0, 0, 0.4));
            }
        }

        .isolated-path {
            transition: all 0.4s;
            cursor: pointer;
        }

        /* Modals & Popups Dynamic Animations */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0);
            backdrop-filter: blur(0px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 5000;
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .modal-overlay.active {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(12px);
        }

        .modal-content {
            background: white;
            border-radius: 40px;
            width: 90%;
            max-width: 1000px;
            overflow: hidden;
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.4);
            transform: scale(0.8) translateY(50px);
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .modal-overlay.active .modal-content {
            transform: scale(1) translateY(0);
            opacity: 1;
        }

        @keyframes modalPop {
            to {
                transform: scale(1);
            }
        }

        .modal-header {
            background: var(--primary);
            color: white;
            padding: 25px 35px;
            font-weight: 800;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 40px;
            overflow-y: auto;
            max-height: 80vh;
        }

        .ciblage-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .ciblage-col {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ciblage-title {
            font-size: 1rem;
            font-weight: 900;
            color: #fff;
            text-transform: uppercase;
            text-align: center;
            border-radius: 14px;
            padding: 15px;
            background: var(--primary);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .diag-card {
            padding: 15px 20px;
            border-radius: 15px;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.02);
            border-left: 6px solid #ccc;
            font-size: 0.8rem;
            font-weight: 700;
            color: #1e293b;
        }

        .diag-prob {
            background: #fff1f2;
            border-left-color: #be123c;
            color: #9f1239;
        }

        .diag-target {
            background: #f0fdf4;
            border-left-color: #15803d;
            color: #14532d;
        }

        .stat-pill {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            background: #fff1f2;
            color: #be123c;
            font-weight: 800;
            font-size: 0.75rem;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .alert-card {
            border: 2px solid #be123c;
            background: #fff1f2;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
        }

        .alert-title {
            color: #be123c;
            font-weight: 900;
            font-size: 0.8rem;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .alert-msg {
            font-size: 1.1rem;
            font-weight: 800;
            color: #9f1239;
            line-height: 1.4;
        }

        /* Styles pour les mini-stats de l'image */
        .grid-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .mini-stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 10px;
            background: #f8fafc;
            border-radius: 15px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .mini-stat-icon {
            color: var(--primary);
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .mini-stat-value {
            font-weight: 800;
            color: var(--primary-dark);
            font-size: 0.9rem;
        }

        .mini-stat-label {
            font-size: 0.65rem;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
        }

        /* Animation des cartes de données */
        .ui-card,
        .diag-card {
            opacity: 0;
            transform: translateY(15px);
            animation: fadeInUp 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }

        /* Animation des lignes d'indicateurs (décalage progressif) */
        .indicator-row {
            opacity: 0;
            transform: translateX(-10px);
            animation: fadeInRight 0.5s ease-out forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInRight {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Effet au survol des cartes de diagnostic */
        .diag-card {
            transition: all 0.3s ease;
        }

        .diag-card:hover {
            transform: scale(1.02) translateX(5px);
            box-shadow: 0 10px 20px rgba(225, 29, 72, 0.15);
        }


        /* --- Animation Robuste des Histogrammes --- */

        /* 1. On cible les barres du panneau de droite */
        #panel-right [style*="height"] {
            transform-origin: bottom;
            animation: slideUpBar 1.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            will-change: transform;
            border-radius: 4px 4px 0 0;
            position: relative;
        }

        #panel-right [style*="height"]::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.3), transparent);
            pointer-events: none;
        }

        /* 2. L'animation utilise scaleY pour ne pas perturber les hauteurs */
        @keyframes slideUpBar {
            from {
                transform: scaleY(0);
                opacity: 0;
            }

            to {
                transform: scaleY(1);
                opacity: 1;
            }
        }

        /* 3. Animation des chiffres (labels) pour qu'ils apparaissent après la barre */
        #panel-right span[style*="position: absolute"] {
            opacity: 0;
            animation: fadeInLabel 0.5s ease-out forwards;
            animation-delay: 1s;
            /* Délai pour attendre la fin de la montée */
        }

        @keyframes fadeInLabel {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- Premium Header Buttons (Red Theme) --- */
        .btn-header-pill {
            background: white;
            color: var(--primary);
            width: 50px;
            height: 50px;
            border-radius: 50px;
            border: 1px solid rgba(225, 29, 72, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(225, 29, 72, 0.08);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
            text-decoration: none;
        }

        .btn-header-pill i {
            font-size: 1.25rem;
            z-index: 2;
        }

        .btn-header-pill::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, #fff1f2, #ffe4e6);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .btn-header-pill:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 25px rgba(225, 29, 72, 0.2);
            border-color: var(--accent);
        }

        .btn-header-pill:hover::before {
            opacity: 1;
        }

        /* Specific Hover Transitions */
        .btn-home:hover {
            color: #9f1239;
        }

        .btn-reset:hover {
            color: #d97706;
        }

        /* Orange accent for reset */
        .btn-diag:hover {
            color: #e11d48;
        }

        /* --- Updated Diagnostic Popup Styles (Premium Staggered) --- */
        .diag-row-container {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease-out;
            display: grid;
            margin-bottom: 12px;
        }

        .diag-row-container.active {
            opacity: 1;
            transform: translateY(0);
        }

        .diag-cell-new {
            background: #fff1f2;
            border-radius: 50px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            min-height: 50px;
            transition: all 0.3s;
            border-left: 6px solid #be123c;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .diag-target-new-pill {
            background: #f0fdf4;
            border-left-color: #15803d;
        }

        .diag-cell-new:hover {
            transform: scale(1.02) translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .icon-circle-diag {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            flex-shrink: 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .diag-text-premium {
            font-size: 0.72rem;
            font-weight: 700;
            line-height: 1.3;
        }

        .ciblage-title-premium {
            padding: 10px;
            border-radius: 50px;
            text-align: center;
            color: white;
            font-weight: 800;
            font-size: 0.8rem;
            text-transform: uppercase;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div id="loading-screen"
        style="display: none; position: fixed; inset: 0; background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <div class="loader-spinner"
            style="width: 60px; height: 60px; border: 5px solid #f3f3f3; border-top: 5px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite;">
        </div>
        <p
            style="margin-top: 20px; font-weight: 800; color: var(--primary); letter-spacing: 2px; text-transform: uppercase; font-size: 0.8rem;">
            Analyse des données en cours...</p>
    </div>

    <div class="bg-master"></div>
    <div class="bg-overlay"></div>

    <header>
        <div class="logo-box" onclick="location.href='index.html'">
            <img src="img/logo_french.png" alt="Logo">
        </div>
        <div class="header-center">
            <div class="pdti-subtitle">PDTI Tan-Tan | Vers un territoire inclusif, durable et attractif</div>
            <div class="maroc-separator">
                <span class="line"></span>
                <span class="province-text">AXE SANTÉ</span>
                <span class="line"></span>
            </div>
        </div>
        <div class="logo-box" onclick="location.href='index.html'">
            <img src="img/logo_arabe.png" alt="Logo">
        </div>
        <div class="header-actions">
            <button onclick="showCiblage()" class="btn-header-pill btn-diag" title="Diagnostic - Santé">
                <i class="fa-solid fa-bullseye"></i>
            </button>
            <button class="btn-header-pill btn-home" onclick="location.href='tantan.html'" title="Retour à l'Accueil">
                <i class="fa-solid fa-house"></i>
            </button>
            <button class="btn-header-pill btn-reset" onclick="location.reload()" title="Réinitialiser la vue">
                <i class="fa-solid fa-rotate"></i>
            </button>
        </div>
    </header>

    <div class="middle-container">
        <div class="side-panel" id="panel-left">
            <div class="filter-container-left">
                <div class="filter-row">
                    <button class="btn-filter-left" onclick="isolateGroup('urbain')">
                        <div style="width:12px; height:12px; border-radius:50%; background: var(--color-urbain);"></div>
                        Urbain
                    </button>
                    <button class="btn-filter-left" onclick="isolateGroup('rural')">
                        <div style="width:12px; height:12px; border-radius:50%; background: var(--color-rural);"></div>
                        Rural
                    </button>
                </div>
                <div id="sub-filter-urbain" class="filter-row" style="display: none; margin-top: 5px;">
                    <button class="btn-commune-urbaine" id="btn-tantan" onclick="showTanTanDetails()">Tan-Tan</button>
                    <button class="btn-commune-urbaine" id="btn-elouatia" onclick="showElOuatiaDetails()">El
                        Ouatia</button>
                </div>
            </div>
            <div id="panel-left-content">
                <div class="ui-card stagger-item">
                    <div class="card-profile-header">OFFRE PROVINCIALE</div>
                    <div class="grid-stats">
                        <div class="mini-stat-item stagger-item">
                            <i class="fa-solid fa-hospital mini-stat-icon"></i>
                            <span class="mini-stat-value">01 CHP</span>
                            <span class="mini-stat-label">Depuis 1978</span>
                        </div>
                        <div class="mini-stat-item stagger-item">
                            <i class="fa-solid fa-bed mini-stat-icon"></i>
                            <span class="mini-stat-value">84 Lits</span>
                            <span class="mini-stat-label">Opérationnels</span>
                        </div>
                        <div class="mini-stat-item stagger-item">
                            <i class="fa-solid fa-house-chimney-medical mini-stat-icon"></i>
                            <span class="mini-stat-value">10 ESSP</span>
                            <span class="mini-stat-label">Établissements</span>
                        </div>
                        <div class="mini-stat-item stagger-item">
                            <i class="fa-solid fa-droplet mini-stat-icon"></i>
                            <span class="mini-stat-value">01 Centre</span>
                            <span class="mini-stat-label">Hémodialyse</span>
                        </div>
                        <div class="mini-stat-item stagger-item">
                            <i class="fa-solid fa-user-doctor mini-stat-icon"></i>
                            <span class="mini-stat-value">36</span>
                            <span class="mini-stat-label">Médecins</span>
                        </div>
                        <div class="mini-stat-item stagger-item">
                            <i class="fa-solid fa-user-nurse mini-stat-icon"></i>
                            <span class="mini-stat-value">186</span>
                            <span class="mini-stat-label">Infirmiers</span>
                        </div>
                        <div class="mini-stat-item stagger-item">
                            <i class="fa-solid fa-truck-medical mini-stat-icon"></i>
                            <span class="mini-stat-value">07</span>
                            <span class="mini-stat-label">Ambulances</span>
                        </div>
                        <div class="mini-stat-item stagger-item">
                            <i class="fa-solid fa-wheelchair mini-stat-icon"></i>
                            <span class="mini-stat-value">01</span>
                            <span class="mini-stat-label">Centre PSH</span>
                        </div>
                    </div>


                </div>
            </div>
        </div>

        <div id="map-container">
            <div id="map-detail"></div>
            <div id="map-overlay"></div>
            <div id="isolated-box"><svg id="isolated-svg" preserveAspectRatio="xMidYMid meet"></svg></div>
        </div>
        <div class="side-panel" id="panel-right">
            <div class="stagger-item"
                style="margin-top: 15px; border-radius: 12px; background: linear-gradient(135deg, #fff, #fff1f2); padding: 15px; display: flex; align-items: center; gap: 15px; border: 1px solid #fb7185; box-shadow: 0 4px 15px rgba(225, 29, 72, 0.1);">
                <div
                    style="width: 50px; height: 50px; border-radius: 50%; background: #be123c; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: #fff; flex-shrink: 0; box-shadow: 0 4px 10px rgba(190, 18, 60, 0.3);">
                    <i class="fa-solid fa-triangle-exclamation"></i>
                </div>
                <ul
                    style="color: #881337; font-weight: 700; font: size 15px; list-style: none; padding: 0; margin: 0; line-height: 1.5; flex: 1;">
                    <li style="display: flex; align-items: center; gap: 8px;">Fréquence des transferts des patients
                        (35%).</li><br>
                    <li style="display: flex; align-items: center; gap: 8px;"> Faible capacité des analyses médicales
                        (-47%).</li><br>
                    <li style="display: flex; align-items: center; gap: 8px;"> 17 patients souffrant d’insuffisance
                        rénale ne sont pas encore pris en charge.</li>
                </ul>

            </div>


            <div class="stagger-item"
                style="margin-top: 15px; border-radius: 12px; background: linear-gradient(135deg, #fff, #fff1f2); padding: 15px; display: flex; align-items: center; gap: 15px; border: 1px solid #fb7185; box-shadow: 0 4px 15px rgba(225, 29, 72, 0.1);">
                <div
                    style="width: 50px; height: 50px; border-radius: 50%; background: #be123c; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: #fff; flex-shrink: 0; box-shadow: 0 4px 10px rgba(190, 18, 60, 0.3);">
                    <i class="fa-solid fa-triangle-exclamation"></i>
                </div>
                <ul
                    style="color: #881337; font-weight: 700; font: size 15px; list-style: none; padding: 0; margin: 0; line-height: 1.5; flex: 1;">
                    <li style="display: flex; align-items: center; gap: 8px;"> Faible attractivité du personnel médical
                    </li>
                </ul>

            </div>

            <div class="stagger-item"
                style="margin-top: 15px; border-radius: 12px; background: linear-gradient(135deg, #fff, #fff1f2); padding: 15px; display: flex; align-items: center; gap: 15px; border: 1px solid #fb7185; box-shadow: 0 4px 15px rgba(225, 29, 72, 0.1);">
                <div
                    style="width: 50px; height: 50px; border-radius: 50%; background: #be123c; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: #fff; flex-shrink: 0; box-shadow: 0 4px 10px rgba(190, 18, 60, 0.3);">
                    <i class="fa-solid fa-triangle-exclamation"></i>
                </div>
                <ul
                    style="color: #881337; font-weight: 700;font: size 15px; list-style: none; padding: 0; margin: 0; line-height: 1.5; flex: 1;">
                    <li style="display: flex; align-items: center; gap: 8px;"> Absence de structures spécialisées
                        d’appui (CDTMR, CSJ, CRSR…)</li>
                </ul>

            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <a href="education.html" class="nav-btn"><i class="fa-solid fa-graduation-cap"></i> ÉDUCATION</a>
        <a href="sante.html" class="nav-btn active"><i class="fa-solid fa-notes-medical"></i> SANTÉ</a>
        <a href="eau.html" class="nav-btn"><i class="fa-solid fa-droplet"></i> EAU</a>
        <a href="mise_a_niveau.html" class="nav-btn"><i class="fa-solid fa-road"></i> MAN</a>
        <a href="emploi.html" class="nav-btn"><i class="fa-solid fa-briefcase"></i> EMPLOI</a>
    </div>

    <div id="alertPopup" class="modal-overlay" onclick="closePopupCiblage()">
        <div class="modal-content" id="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div><i class="fa-solid fa-notes-medical"></i> <span id="popup-title">DIAGNOSTIC SANTÉ</span></div>
                <span style="cursor:pointer; font-size: 28px;" onclick="closePopupCiblage()">&times;</span>
            </div>
            <div class="modal-body" id="popup-body"></div>
        </div>
    </div>

    <!-- New Programme Popup Sante -->
    <div id="programmePopup" class="modal-overlay" onclick="closeProgrammePopup()">
        <div class="modal-content" id="prog-modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="header-titles">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <i class="fa-solid fa-list-ul" style="font-size:1.2rem;"></i>
                        <span class="top-tag" style="font-size:1.2rem; font-weight:800;">Santé</span>
                    </div>
                </div>
                <span class="close-modal" onclick="closeProgrammePopup()"
                    style="font-size:2rem; cursor:pointer;">&times;</span>
            </div>
            <div class="modal-body" id="prog-popup-body"></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map("map-detail", { zoomControl: false, attributionControl: false });
        const ruralNames = ["Chbika", "Abteh", "Msied", "Tilemzoun", "Ben Khelil"];
        const urbainNames = ["Tan-Tan", "El Ouatia"];
        let layersMap = {};

        function highlightSVGCommune(name) {
            document.querySelectorAll('.isolated-path').forEach(p => p.classList.remove('pop-active'));
            const target = document.getElementById(`path-${name.replace(/\s+/g, '-')}`);
            if (target) target.classList.add('pop-active');
        }



        // --- RURAL FUNCTIONS ---

        function showRuralLeft() {
            closeView();
            document.getElementById('sub-filter-urbain').style.display = 'none';
            document.getElementById('panel-left-content').innerHTML = `
        <div class="ui-card stagger-item" onclick="showRuralDetails()">
          <div class="card-profile-header">MILIEU RURAL</div>
          <div class="indicator-row stagger-item">
            <div class="indicator-icon"><i class="fa-solid fa-landmark"></i></div>
            <div class="indicator-label">05 Communes rurales</div>
          </div>
          <div class="indicator-row stagger-item">
            <div class="indicator-icon"><i class="fa-solid fa-users"></i></div>
            <div class="indicator-label">4 127 Habitants</div>
          </div>
          <div class="indicator-row stagger-item">
            <div class="indicator-icon"><i class="fa-solid fa-map-location-dot"></i></div>
            <div class="indicator-label">17 255 km² de territoire</div>
          </div>
          <div class="card-profile-header stagger-item" style="background: #fb7185; margin-top:20px; font-size: 0.7rem;">CHIFFRES CLÉS</div>
           <table class="data-table stagger-item">
            <tr><td>Médecins</td><td style="color:#be123c;">00</td></tr>
            <tr><td>Infirmiers</td><td>04</td></tr>
            <tr><td>CSR1 en cours de construction</td><td style="color:#be123c;">02</td></tr>
            <tr><td>CSR1 en cours de réhabilitation</td><td>03 </td></tr>
          </table>
        </div>
      `;
            showRuralDetails();
        }

        function showRuralDetails() {
            document.getElementById('panel-right').innerHTML = `
        <div class="alert-card" style="margin-top:20px; animation: cardFadeIn 0.8s ease;">
          <div class="alert-title">CONSTAT MAJEUR</div>
          <div style="font-size:3rem; margin-bottom:15px;">⚠️</div>
          <div class="alert-msg">Faiblesse des soins de santé de proximité.</div><br>
          <div class="alert-msg">Les femmes enceintes doivent voyager pour accoucher.</div><br>
          <div class="alert-msg">Délai de transfert > 1h30 vers l'hôpital le plus proche.</div>
        </div>
      `;
        }

        // --- URBAIN FUNCTIONS ---

        function showUrbainLeft() {
            closeView();
            document.getElementById('sub-filter-urbain').style.display = 'flex';

            // On vide le panneau de droite pour forcer l'utilisateur à choisir une ville
            document.getElementById('panel-right').innerHTML = `
        
    `;

            document.getElementById('panel-left-content').innerHTML = `
        <div class="ui-card stagger-item">
          <div class="card-profile-header">MILIEU URBAIN</div>
          <div class="indicator-row stagger-item">
            <div class="indicator-icon"><i class="fa-solid fa-city"></i></div>
            <div class="indicator-label">02 Communes urbaines</div>
          </div>

          <div class="indicator-row stagger-item">
            <div class="indicator-icon"><i class="fa-solid fa-users"></i></div>
            <div class="indicator-label">90 392 Habitants</div>
          </div>
          <div class="indicator-row stagger-item">
            <div class="indicator-icon"><i class="fa-solid fa-map-location-dot"></i></div>
            <div class="indicator-label">47 km² de territoire</div>
          </div>


          <div class="indicator-row stagger-item">
            <div class="indicator-icon"><i class="fa-solid fa-hospital-user"></i></div>
            <div class="indicator-label">Concentration de l'offre provinciale</div>
          </div>
        </div>

    `;
        }

        function showTanTanDetails() {
            highlightSVGCommune('Tan-Tan');
            document.querySelectorAll('.btn-commune-urbaine').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-tantan').classList.add('active');

            document.getElementById('panel-left-content').innerHTML = `
        <div class="ui-card stagger-item" onclick="showTanTanRight()">
          <div class="card-profile-header">VILLE DE TAN-TAN</div>
          <div class="indicator-row stagger-item"><div class="indicator-icon"><i class="fa-solid fa-hospital"></i></div><div class="indicator-label">01 CHP</div></div>
          <div class="indicator-row stagger-item"><div class="indicator-icon"><i class="fa-solid fa-bed"></i></div><div class="indicator-label">84 Lits opérationnels</div></div>
          <div class="indicator-row stagger-item"><div class="indicator-icon"><i class="fa-solid fa-house-medical"></i></div><div class="indicator-label">04 CSU</div></div>
        <div class="indicator-row stagger-item"><div class="indicator-icon"><i class="fa-solid fa-house-medical"></i></div><div class="indicator-label">01 Centre d'hémodialyse</div></div>

          <table class="data-table stagger-item" style="margin-top:15px;">
            <tr><td>Médecins </td><td>33</td></tr>
            <tr><td>Infirmiers</td><td>164</td></tr>
            <tr><td>Ambulances</td><td>06</td></tr>
          </table>
        </div>
      `;
            showTanTanRight();
        }

        function closeView() {
            document.getElementById('map-overlay').classList.remove('active');
            document.getElementById('map-detail').style.filter = "none";
            document.getElementById('isolated-box').classList.remove('active');

            // Panneau gauche (inchangé)
            document.getElementById('panel-left-content').innerHTML = `
                <div class="ui-card">
                    <div class="card-profile-header">OFFRE PROVINCIALE</div>
                    <div class="grid-stats">
                        <div class="mini-stat-item"><i class="fa-solid fa-hospital mini-stat-icon"></i><span class="mini-stat-value">01 CHP</span><span class="mini-stat-label">Depuis 1978</span></div>
                        <div class="mini-stat-item"><i class="fa-solid fa-bed mini-stat-icon"></i><span class="mini-stat-value">84 Lits</span><span class="mini-stat-label">Opérationnels</span></div>
                        <div class="mini-stat-item"><i class="fa-solid fa-house-chimney-medical mini-stat-icon"></i><span class="mini-stat-value">10 ESSP</span><span class="mini-stat-label">Établissements</span></div>
                        <div class="mini-stat-item"><i class="fa-solid fa-droplet mini-stat-icon"></i><span class="mini-stat-value">01 Centre</span><span class="mini-stat-label">Hémodialyse</span></div>
                        <div class="mini-stat-item"><i class="fa-solid fa-user-doctor mini-stat-icon"></i><span class="mini-stat-value">36</span><span class="mini-stat-label">Médecins</span></div>
                        <div class="mini-stat-item"><i class="fa-solid fa-user-nurse mini-stat-icon"></i><span class="mini-stat-value">186</span><span class="mini-stat-label">Infirmiers</span></div>
                        <div class="mini-stat-item"><i class="fa-solid fa-truck-medical mini-stat-icon"></i><span class="mini-stat-value">07</span><span class="mini-stat-label">Ambulances</span></div>
                        <div class="mini-stat-item"><i class="fa-solid fa-wheelchair mini-stat-icon"></i><span class="mini-stat-value">01</span><span class="mini-stat-label">Centre PSH</span></div>
                    </div>
                    <div class="card-profile-header" style="background: #d97706; margin-top:20px; font-size: 0.7rem;">POSTES VACANTS</div>
                    <table class="data-table">
                        <tr><td><i class="fa-solid fa-user-doctor"></i> Médecins vacants</td><td style="color:#d97706;">30</td></tr>
                        <tr><td><i class="fa-solid fa-user-nurse"></i> Infirmiers vacants</td><td style="color:#d97706;">50</td></tr>
                    </table>
                </div>
            `;

            // Panneau droit (MODIFIÉ : CLICKABLE)
            document.getElementById('panel-right').innerHTML = `
                <div class="ui-card" onclick="showGraphPopup('ratios-prov')" style="cursor: pointer; border: 1.5px solid #b22222; padding: 15px 10px; background: white;">
                    <div style="background: #fb7185; color: white; text-align: center; padding: 8px; font-weight: 800; border-radius: 4px; font-size: 1rem; margin-bottom: 20px;">
                        Principaux ratios (Zoom <i class="fa-solid fa-magnifying-glass-plus"></i>)
                    </div>
                    <div style="display: flex; justify-content: center; gap: 10px; font-size: 0.7rem; font-weight: 700; margin-bottom: 25px;">
                        <span><i class="fa-solid fa-square" style="color: #9f1239;"></i> Province</span>
                        <span><i class="fa-solid fa-square" style="color: #e83b55;"></i> Régional</span>
                        <span><i class="fa-solid fa-square" style="color: #f5a2af;"></i> National</span>
                    </div>
                    <div style="display: flex; justify-content: space-around; align-items: flex-end; height: 150px; border-bottom: 2px solid #ccc; padding-bottom: 5px;">
                        <div style="display: flex; align-items: flex-end; gap: 3px; height: 100%;">
                            <div style="background: #9f1239; width: 12px; height: 100%; position: relative;"><span style="position: absolute; top: -18px; left: -10px; font-size: 0.6rem; font-weight: 800;">19033</span></div>
                            <div style="background: #e83b55; width: 12px; height: 23%; position: relative;"></div>
                            <div style="background: #f5a2af; width: 12px; height: 63%; position: relative;"></div>
                        </div>
                        <div style="display: flex; align-items: flex-end; gap: 3px; height: 100%;">
                            <div style="background: #9f1239; width: 12px; height: 12%; position: relative;"><span style="position: absolute; top: -18px; left: -5px; font-size: 0.6rem; font-weight: 800;">2307</span></div>
                            <div style="background: #e83b55; width: 12px; height: 21%; position: relative;"></div>
                            <div style="background: #f5a2af; width: 12px; height: 18%; position: relative;"></div>
                        </div>
                        <div style="display: flex; align-items: flex-end; gap: 3px; height: 100%;">
                            <div style="background: #9f1239; width: 12px; height: 3%; position: relative;"><span style="position: absolute; top: -18px; left: 0; font-size: 0.6rem; font-weight: 800;">464</span></div>
                            <div style="background: #e83b55; width: 12px; height: 3%; position: relative;"></div>
                            <div style="background: #f5a2af; width: 12px; height: 5%; position: relative;"></div>
                        </div>
                        <div style="display: flex; align-items: flex-end; gap: 3px; height: 100%;">
                            <div style="background: #9f1239; width: 12px; height: 5%; position: relative;"><span style="position: absolute; top: -18px; left: 0; font-size: 0.6rem; font-weight: 800;">906</span></div>
                            <div style="background: #e83b55; width: 12px; height: 6%; position: relative;"></div>
                            <div style="background:#f5a2af; width: 12px; height: 7%; position: relative;"></div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-around; font-size: 0.7rem; font-weight: 800; margin-top: 10px; text-align: center;">
                        <span style="width: 20%;">Hab/ESSP</span><span style="width: 20%;">Hab/Méd</span><span style="width: 20%;">Hab/Inf</span><span style="width: 20%;">Hab/Lit</span>
                    </div>
                </div>

                <div style="display: flex; gap: 8px; margin-top: 10px;">
                    <div class="ui-card" onclick="showGraphPopup('prenatal-prov')" style="cursor: pointer; flex: 1; border: 1.5px solid #b22222; background: white; padding:0; overflow:hidden;">
                        <div style="background: #bc0000; color: white; font-size: 0.65rem; font-weight: 800; text-align: center; padding: 4px;">Taux de surveillance prénatale <i class="fa-solid fa-magnifying-glass-plus"></i></div>
                        <div style="padding: 10px 5px;">
                            <div style="display: flex; justify-content: space-around; align-items: flex-end; height: 60px; border-bottom: 1px solid #ccc;">
                                <div style="background: #bc0000; width: 15px; height: 57%; position: relative;"><span style="position: absolute; top: -14px; width: 100%; text-align: center; font-size: 0.65rem; font-weight: 800;">57</span></div>
                                <div style="background: #bc0000; width: 15px; height: 47%; position: relative;"></div>
                                <div style="background: #bc0000; width: 15px; height: 59%; position: relative;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-around; font-size: 0.55rem; font-weight: 800; margin-top: 4px;"><span>Prov.</span><span>Rég.</span><span>Nat.</span></div>
                        </div>
                    </div>
                    <div class="ui-card" onclick="showGraphPopup('accouchement-prov')" style="cursor: pointer; flex: 1; border: 1.5px solid #5dade2; background: white; padding:0; overflow:hidden;">
                        <div style="background: #5dade2; color: white; font-size: 0.65rem; font-weight: 800; text-align: center; padding: 4px;">Accouchement hospitalier <i class="fa-solid fa-magnifying-glass-plus"></i></div>
                        <div style="padding: 10px 5px;">
                            <div style="display: flex; justify-content: space-around; align-items: flex-end; height: 60px; border-bottom: 1px solid #ccc;">
                                <div style="background: #5dade2; width: 15px; height: 58%; position: relative;"><span style="position: absolute; top: -14px; width: 100%; text-align: center; font-size: 0.65rem; font-weight: 800;">58</span></div>
                                <div style="background: #5dade2; width: 15px; height: 34%; position: relative;"></div>
                                <div style="background: #5dade2; width: 15px; height: 48%; position: relative;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-around; font-size: 0.55rem; font-weight: 800; margin-top: 4px;"><span>Prov.</span><span>Rég.</span><span>Nat.</span></div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 10px; border: 1.5px solid #b22222; background: white; padding: 10px; display: flex; align-items: center; gap: 10px;">
                    <div style="font-size: 1.5rem; color: #bc0000;"><i class="fa-solid fa-triangle-exclamation"></i></div>
                    <ul style="color: #bc0000; font-weight: 800; font-size: 0.75rem; list-style: none; padding: 0; margin: 0; line-height: 1.2;">
                        <li>♦ Fréquence des transferts des patients</li>
                        <li>♦ Faible capacité des analyses médicales</li>
                        <li>♦ 17 patients en attente (hémodialyse)</li>
                    </ul>
                </div>
            `;

            document.getElementById('sub-filter-urbain').style.display = 'none';
            map.fitBounds(group.getBounds(), { padding: [20, 20] });
        }

        function showTanTanRight() {
            document.getElementById('panel-right').innerHTML = `
                

                <div class="ui-card stagger-item" style="margin-top:15px; border-top: 5px solid #be123c;">
                    <div class="diag-card diag-prob stagger-item" style="margin-bottom:8px; font-size:15px;">Offre de soins de proximité très faible</div>
                    <div class="diag-card diag-prob stagger-item" style="margin-bottom:8px; font-size:15px;">Vétusté et sous-dimensionnement du CHP</div>
                    <div class="diag-card diag-prob stagger-item" style="margin-bottom:8px; font-size:15px;">Faible attractivité du personnel médical</div>
                    <div class="diag-card diag-prob stagger-item" style="margin-bottom:8px; font-size:15px;">Insuffisance du parc ambulancier</div>
                    <div class="diag-card diag-prob stagger-item" style="margin-bottom:8px; font-size:15px;">Inégalités intra-quartiers en offre de soins</div>
                </div>



                <div class="ui-card stagger-item" style="margin-top:15px; border-top: 5px solid #be123c;">
                    <div class="diag-card diag-prob stagger-item" style="margin-bottom:8px; font-size:15px  ;">Absence de structures spécialisées d’appui(CDTMR, CSJ, CRSR…)</div>
                </div>
            `;
            setTimeout(() => { document.querySelectorAll('.stagger-item').forEach((el) => { el.style.animation = 'none'; el.offsetHeight; el.style.animation = null; }); }, 50);
        }

        function showElOuatiaDetails() {
            highlightSVGCommune('El Ouatia');
            document.querySelectorAll('.btn-commune-urbaine').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-elouatia').classList.add('active');

            document.getElementById('panel-left-content').innerHTML = `
        <div class="ui-card stagger-item" onclick="showElOuatiaRight()">
          <div class="card-profile-header" style="background: linear-gradient(135deg, var(--accent), var(--primary));">VILLE D'EL OUATIA</div>
          <div class="indicator-row stagger-item"><div class="indicator-icon"><i class="fa-solid fa-route"></i></div><div class="indicator-label">20 km au CHP</div></div>
          <div class="indicator-row stagger-item"><div class="indicator-icon"><i class="fa-solid fa-house-medical"></i></div><div class="indicator-label">01 CSU2</div></div>
          <table class="data-table stagger-item" style="margin-top:15px;">
            <tr><td>Médecins</td><td>02</td></tr>
            <tr><td>Infirmiers</td><td>06</td></tr>
          </table>
        </div>
      `;
            showElOuatiaRight();
        }

        function showElOuatiaRight() {
            document.getElementById('panel-right').innerHTML = `
                <div class="alert-card" style="margin-top:20px; animation: cardFadeIn 0.8s ease;">
               <div class="alert-msg">une ville côtière avec un port de pêche d’ampleur nationale</div>
            </div>
            
            <div class="ui-card stagger-item" style="margin-top:15px; border-top: 5px solid #be123c;">
                    <div class="diag-card diag-prob stagger-item" style="margin-bottom:8px; font-size:15px;">Offre de soins de proximité très faible</div>
                    <div class="diag-card diag-prob stagger-item" style="margin-bottom:8px; font-size:15px;">Manque des services d’urgences</div>
                    <div class="diag-card diag-prob stagger-item" style="margin-bottom:8px; font-size:15px;">Manque des services de chirurgie</div>
                    <div class="diag-card diag-prob stagger-item" style="margin-bottom:8px; font-size:15px;">Manque d’un hôpital de proximité</div>
                    <div class="diag-card diag-prob stagger-item" style="margin-bottom:8px; font-size:15px;">Manque d’une ambulance médicalisée</div>
                    <div class="diag-card diag-prob stagger-item" style="margin-bottom:8px; font-size:15px;">Inégalités -intra-quartiers en offre de soins</div>
                    <div class="diag-card diag-prob stagger-item" style="margin-bottom:8px; font-size:15px">Faible attractivité du personnel médical</div>                                    
            </div>
            `;
            setTimeout(() => { document.querySelectorAll('.stagger-item').forEach((el) => { el.style.animation = 'none'; el.offsetHeight; el.style.animation = null; }); }, 50);
        }

        function showGraphPopup(type) {
            const modal = document.getElementById('alertPopup');
            const title = document.getElementById('popup-title');
            const body = document.getElementById('popup-body');
            const contentBox = document.getElementById('modal-content');

            contentBox.style.maxWidth = "1100px";
            document.querySelector('.modal-header').style.background = "var(--primary)";

            // Styles pour les grands graphes avec animation dynamique
            const bigGraphStyle = `
                <style>
                    .big-chart-container { background: #fff1f2; border-radius: 18px; padding: 40px; border: 2px solid #fecdd3; overflow: hidden; }
                    .big-chart-main { display: flex; justify-content: space-around; align-items: flex-end; height: 350px; border-bottom: 3px solid #fda4af; padding-bottom: 15px; }
                    .big-bars-flex { display: flex; align-items: flex-end; gap: 20px; }
                    .big-bar { 
                        width: 50px; 
                        border-radius: 10px 10px 0 0; 
                        transition: height 1.2s cubic-bezier(0.34, 1.56, 0.64, 1); 
                        position: relative; 
                        box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
                        height: 0 !important; /* Initial height for JS animation */
                    }
                    .big-bar-value { 
                        font-size: 1.35rem; 
                        font-weight: 800; 
                        margin-bottom: 12px; 
                        color: #881337; 
                        text-align: center; 
                        white-space: nowrap; 
                        opacity: 0; 
                        transform: translateY(10px);
                        transition: all 0.5s ease;
                    }
                    .big-cycle-label { font-size: 1.1rem; font-weight: 900; margin-top: 20px; color: #be123c; text-transform: uppercase; text-align: center; }
                    .big-legend { display: flex; justify-content: center; gap: 40px; margin-bottom: 35px; font-size: 1.1rem; font-weight: 700; }
                    .big-legend-color { width: 22px; height: 22px; border-radius: 6px; margin-right: 8px; }
                    .bar-wrapper { display: flex; flex-direction: column; align-items: center; }
                    
                    /* Activation states for staggered entrance */
                    .big-bar.animate { height: var(--target-h) !important; }
                    .big-bar-value.animate { opacity: 1; transform: translateY(0); }
                </style>
            `;

            let graphHTML = "";
            let localLabel = "Province";

            // Détection du type
            if (type.includes('tantan')) localLabel = "Tan-Tan";
            else if (type.includes('elouatia')) localLabel = "El Ouatia";

            if (type.includes('ratios')) {
                title.innerHTML = `<i class="fa-solid fa-chart-column"></i> PRINCIPAUX RATIOS - ${localLabel.toUpperCase()}`;

                let d = {};
                let colors = ["#9f1239", "#e83b55", "#f5a2af"];
                let isElOuatia = type.includes('elouatia');

                if (type.includes('prov')) {
                    d = {
                        essp: ["9 518", "4 487", "11 965"],
                        med: ["2 644", "4 042", "3 391"],
                        inf: ["512", "487", "905"],
                        lit: ["1 046", "1 150", "1 314"]
                    };
                } else if (type.includes('tantan')) {
                    d = {
                        essp: ["19 033", "4 487", "11 965"],
                        med: ["464", "487", "905"],
                        inf: ["906", "1 150", "1 314"],
                        lit: ["2 307", "4 042", "3 391"]
                    };
                } else if (type.includes('elouatia')) {
                    d = {
                        essp: ["14 258", "4 487", "11 965"],
                        med: ["7 129", "4 042", "3 391"],
                        inf: ["2 376", "487", "905"]
                    };
                }

                const createBarGroup = (label, values, maxHeight) => {
                    let maxVal = Math.max(...values.map(v => parseInt(v.replace(/\s/g, ''))));
                    return `
                        <div class="cycle-group">
                            <div class="big-bars-flex">
                                ${values.map((v, i) => {
                        let h = (parseInt(v.replace(/\s/g, '')) / maxVal) * maxHeight;
                        return `
                                        <div class="bar-wrapper">
                                            <div class="big-bar-value" data-delay="${i * 100}">${v}</div>
                                            <div class="big-bar" style="--target-h:${h}px; background:${colors[i]}" data-delay="${i * 100}"></div>
                                        </div>
                                    `;
                    }).join('')}
                            </div>
                            <div class="big-cycle-label">${label}</div>
                        </div>
                    `;
                };

                graphHTML = `
                    ${bigGraphStyle}
                    <div class="big-chart-container">
                        <div class="big-legend">
                            <div style="display:flex; align-items:center;"><div class="big-legend-color" style="background:${colors[0]}"></div> ${localLabel}</div>
                            <div style="display:flex; align-items:center;"><div class="big-legend-color" style="background:${colors[1]}"></div> Régional</div>
                            <div style="display:flex; align-items:center;"><div class="big-legend-color" style="background:${colors[2]}"></div> National</div>
                        </div>
                        <div class="big-chart-main">
                            ${createBarGroup("Hab/ESSP", d.essp, 300)}
                            ${createBarGroup("Hab/Méd", d.med, 150)}
                            ${createBarGroup("Hab/Inf", d.inf, 150)}
                            ${!isElOuatia ? createBarGroup("Hab/Lit", d.lit, 150) : ''}
                        </div>
                    </div>
                `;
            } else if (type.includes('prenatal')) {
                title.innerHTML = `<i class="fa-solid fa-baby"></i> SURVEILLANCE PRÉNATALE - ${localLabel.toUpperCase()}`;
                graphHTML = `
                    ${bigGraphStyle}
                    <div class="big-chart-container">
                        <div class="big-legend">
                            <div style="display:flex; align-items:center;"><div class="big-legend-color" style="background:#e11d48"></div> ${localLabel}</div>
                            <div style="display:flex; align-items:center;"><div class="big-legend-color" style="background:#9f1239"></div> Région</div>
                            <div style="display:flex; align-items:center;"><div class="big-legend-color" style="background:#fb7185"></div> National</div>
                        </div>
                        <div class="big-chart-main" style="justify-content: center; gap: 80px;">
                            <div class="cycle-group">
                                <div class="big-bars-flex">
                                    <div class="bar-wrapper"><div class="big-bar-value" data-delay="100">57%</div><div class="big-bar" style="--target-h:250px; background:#e11d48" data-delay="100"></div></div>
                                </div>
                                <div class="big-cycle-label">${localLabel}</div>
                            </div>
                            <div class="cycle-group">
                                <div class="big-bars-flex">
                                    <div class="bar-wrapper"><div class="big-bar-value" data-delay="200">47%</div><div class="big-bar" style="--target-h:206px; background:#9f1239" data-delay="200"></div></div>
                                </div>
                                <div class="big-cycle-label">Région</div>
                            </div>
                            <div class="cycle-group">
                                <div class="big-bars-flex">
                                    <div class="bar-wrapper"><div class="big-bar-value" data-delay="300">59%</div><div class="big-bar" style="--target-h:260px; background:#fb7185" data-delay="300"></div></div>
                                </div>
                                <div class="big-cycle-label">National</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (type.includes('accouchement')) {
                title.innerHTML = `<i class="fa-solid fa-hospital-user"></i> ACCOUCHEMENT HOSPITALIER - ${localLabel.toUpperCase()}`;
                graphHTML = `
                    ${bigGraphStyle}
                    <div class="big-chart-container">
                        <div class="big-legend">
                            <div style="display:flex; align-items:center;"><div class="big-legend-color" style="background:#e11d48"></div> ${localLabel}</div>
                            <div style="display:flex; align-items:center;"><div class="big-legend-color" style="background:#9f1239"></div> Région</div>
                            <div style="display:flex; align-items:center;"><div class="big-legend-color" style="background:#fb7185"></div> National</div>
                        </div>
                        <div class="big-chart-main" style="justify-content: center; gap: 80px;">
                            <div class="cycle-group">
                                <div class="big-bars-flex">
                                    <div class="bar-wrapper"><div class="big-bar-value" data-delay="100">58%</div><div class="big-bar" style="--target-h:250px; background:#e11d48" data-delay="100"></div></div>
                                </div>
                                <div class="big-cycle-label">${localLabel}</div>
                            </div>
                            <div class="cycle-group">
                                <div class="big-bars-flex">
                                    <div class="bar-wrapper"><div class="big-bar-value" data-delay="200">34%</div><div class="big-bar" style="--target-h:146px; background:#9f1239" data-delay="200"></div></div>
                                </div>
                                <div class="big-cycle-label">Région</div>
                            </div>
                            <div class="cycle-group">
                                <div class="big-bars-flex">
                                    <div class="bar-wrapper"><div class="big-bar-value" data-delay="300">48%</div><div class="big-bar" style="--target-h:206px; background:#fb7185" data-delay="300"></div></div>
                                </div>
                                <div class="big-cycle-label">National</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            body.innerHTML = graphHTML;
            modal.style.display = 'flex';

            // Animation Trigger
            setTimeout(() => {
                modal.classList.add('active');

                // Trigger staggered bars animation
                const bars = body.querySelectorAll('.big-bar');
                const values = body.querySelectorAll('.big-bar-value');

                bars.forEach(bar => {
                    const delay = bar.getAttribute('data-delay');
                    setTimeout(() => bar.classList.add('animate'), delay);
                });

                values.forEach(val => {
                    const delay = val.getAttribute('data-delay');
                    setTimeout(() => val.classList.add('animate'), parseInt(delay) + 400);
                });
            }, 50);
        }

        // Add close function to handle animation
        function closePopupCiblage() {
            const modal = document.getElementById('alertPopup');
            modal.classList.remove('active');
            setTimeout(() => {
                modal.style.display = 'none';
                document.getElementById('popup-body').innerHTML = '';
            }, 500);
        }

        function showElOuatiaContent() {
            // On cible le contenu du panneau gauche
            document.getElementById('panel-left-content').innerHTML = `
        <div class="city-badge">VILLE D'EL OUATIA</div>

        <div style="background: #fb7185; color: white; text-align: center; padding: 6px; font-weight: 800; border-radius: 4px; font-size: 0.9rem; margin-bottom: 5px;">
            Principaux ratios
        </div>
        <div class="ui-card" style="border: 1.5px solid #b22222; padding: 10px 5px; background: white; margin-bottom: 20px;">
            <div style="display: flex; justify-content: center; gap: 8px; font-size: 0.65rem; font-weight: 700; margin-bottom: 20px;">
                <span><i class="fa-solid fa-square" style="color: #9f1239;"></i> Tan-Tan</span>
                <span><i class="fa-solid fa-square" style="color: #e67e22;"></i> Rég.</span>
                <span><i class="fa-solid fa-square" style="color: #bdc3c7;"></i> Nat.</span>
            </div>
            <div style="display: flex; justify-content: space-around; align-items: flex-end; height: 100px; border-bottom: 1px solid #ccc; padding-bottom: 5px;">
                <div style="display: flex; align-items: flex-end; gap: 2px; height: 100%;">
                    <div style="background: #9f1239; width: 10px; height: 100%; position: relative;"><span style="position: absolute; top: -14px; left: -8px; font-size: 0.55rem; font-weight: 800;">19033</span></div>
                    <div style="background: #e67e22; width: 10px; height: 23%; position: relative;"><span style="position: absolute; top: -14px; left: -2px; font-size: 0.55rem; font-weight: 800;">4487</span></div>
                    <div style="background: #bdc3c7; width: 10px; height: 63%; position: relative;"><span style="position: absolute; top: -14px; left: -8px; font-size: 0.55rem; font-weight: 800;">11965</span></div>
                </div>
                <div style="display: flex; align-items: flex-end; gap: 2px; height: 100%;">
                    <div style="background: #9f1239; width: 10px; height: 12%; position: relative;"><span style="position: absolute; top: -14px; left: -2px; font-size: 0.55rem; font-weight: 800;">2307</span></div>
                    <div style="background: #e67e22; width: 10px; height: 21%; position: relative;"><span style="position: absolute; top: -14px; left: -2px; font-size: 0.55rem; font-weight: 800;">4042</span></div>
                    <div style="background: #bdc3c7; width: 10px; height: 18%; position: relative;"><span style="position: absolute; top: -14px; left: -2px; font-size: 0.55rem; font-weight: 800;">3391</span></div>
                </div>
            </div>
            <div style="display: flex; justify-content: space-around; font-size: 0.6rem; font-weight: 800; margin-top: 5px; text-align: center;">
                <span style="width: 50%;">Hab/ESSP</span>
                <span style="width: 50%;">Hab/Méd.</span>
            </div>
        </div>

        <div class="stat-item">
            <i class="fa-solid fa-hospital-user"></i>
            <div>
                <div class="stat-value">01 Centre de Santé</div>
                <div class="stat-label">Niveau 2 avec module d'accouchement</div>
            </div>
        </div>
        <div class="stat-item">
            <i class="fa-solid fa-bed"></i>
            <div>
                <div class="stat-value">04 Lits</div>
                <div class="stat-label">Capacité d'accueil</div>
            </div>
        </div>
        <div class="stat-item">
            <i class="fa-solid fa-user-doctor"></i>
            <div>
                <div class="stat-value">03 Médecins</div>
                <div class="stat-label">Généralistes</div>
            </div>
        </div>
        <div class="stat-item">
            <i class="fa-solid fa-user-nurse"></i>
            <div>
                <div class="stat-value">12 Infirmiers</div>
                <div class="stat-label">Corps paramédical</div>
            </div>
        </div>
        <div class="stat-item">
            <i class="fa-solid fa-truck-medical"></i>
            <div>
                <div class="stat-value">02 Ambulances</div>
                <div class="stat-label">Véhicules d'urgence</div>
            </div>
        </div>
    `;
        }

        const diagnosticData = [
            {
                icon: "fa-hospital",
                prob: "Vétusté et sous-dimensionnement du CHP",
                target: "Rénovation et adaptation du CHP aux normes de la médecine moderne"
            },
            {
                icon: "fa-truck-medical",
                prob: "Taux élevé des transferts des patients (35%)",
                target: "Réduire le Taux des transferts des patients à 5%"
            },
            {
                icon: "fa-microscope",
                prob: "Déficit flagrant en analyses médicales (-47%)",
                target: "Atteindre 80% de la capacité des analyses médicales"
            },
            {
                icon: "fa-map-location-dot",
                prob: "Inégalités -intra-quartiers en offre de soins",
                target: "Elargir l’offre des soins de santé aux quartiers périphériques"
            },
            {
                icon: "fa-hand-holding-medical",
                prob: "Absence des structures spécialisées d'appui(CDTMR, centres de référence,,)",
                target: "Mise en place des structures spécialisées d'appui( CDTMR, CRSR, CSJ…)"
            },
            {
                icon: "fa-droplet",
                prob: "17 patients souffrant d’insuffisance rénale ne sont pas encore pris en charge",
                target: "Prise en charge totale des patients souffrant d’insuffisance rénale"
            },
            {
                icon: "fa-user-doctor",
                prob: "Faible attractivité du personnel médical",
                target: "Améliorer l'attractivité du personnel médical"
            },
            {
                icon: "fa-ambulance",
                prob: "Insuffisance du parc ambulancier",
                target: "Renforcement du parc ambulancier"
            }
        ];

        function showCiblage() {
            const body = document.getElementById('popup-body');
            const title = document.getElementById('popup-title');

            title.innerText = "DIAGNOSTIC & CIBLAGE - SANTÉ";

            let html = `
                <div class="ciblage-grid" style="grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="ciblage-title-premium" style="background: #be123c;">PROBLÉMATIQUES MAJEURES</div>
                    <div class="ciblage-title-premium" style="background: #15803d;">CIBLAGE & STRATÉGIE</div>
                </div>

                <div id="diag-rows-wrapper" style="display:flex; flex-direction:column; gap:12px;">
            `;

            diagnosticData.forEach((item, index) => {
                html += `
                    <div class="diag-row-container" id="diag-row-${index}" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                        <!-- Prob -->
                        <div class="diag-cell-new">
                            <div class="icon-circle-diag" style="color:#be123c;">
                                <i class="fa-solid ${item.icon}"></i>
                            </div>
                            <div class="diag-text-premium" style="color:#881337;">${item.prob}</div>
                        </div>
                        <!-- Target -->
                        <div class="diag-cell-new diag-target-new-pill">
                            <div class="icon-circle-diag" style="color:#15803d;">
                                <i class="fa-solid ${item.icon}"></i>
                            </div>
                            <div class="diag-text-premium" style="color:#14532d;">${item.target}</div>
                        </div>
                    </div>
                `;
            });

            html += `</div>
            
            <!-- Floating Next Button -->
            <button onclick="showProgramme2026()" class="btn-next-diag-float" title="Voir le Programme Prioritaire 2026">
                <i class="fa-solid fa-arrow-right"></i>
            </button>
            
            <style>
                .btn-next-diag-float {
                    position: absolute;
                    bottom: 30px;
                    right: 30px;
                    width: 65px;
                    height: 65px;
                    border-radius: 50%;
                    background: #be123c; /* Page Primary Red */
                    color: white;
                    border: 4px solid white;
                    box-shadow: 0 10px 25px rgba(190, 18, 60, 0.4);
                    font-size: 1.5rem;
                    cursor: pointer;
                    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 100;
                    animation: floatBtnEnter 0.6s 0.5s cubic-bezier(0.16, 1, 0.3, 1) backwards;
                }
                .btn-next-diag-float:hover {
                    transform: scale(1.1) rotate(-10deg);
                    background: #9f1239;
                    box-shadow: 0 15px 35px rgba(190, 18, 60, 0.5);
                }
                @keyframes floatBtnEnter {
                    from { transform: scale(0) rotate(180deg); opacity: 0; }
                    to { transform: scale(1) rotate(0); opacity: 1; }
                }
                
                /* INCREASE DIAGNOSTIC TEXT SIZE */
                .diag-text-premium {
                    font-size: 1.05rem !important;
                    line-height: 1.4;
                    font-weight: 700;
                }
            </style>
            `;

            body.innerHTML = html;
            const modal = document.getElementById('alertPopup');
            modal.style.display = 'flex';

            // Staggered Animation
            setTimeout(() => {
                modal.classList.add('active');
                const rows = document.querySelectorAll('.diag-row-container');
                rows.forEach((row, index) => {
                    setTimeout(() => {
                        row.classList.add('active');
                    }, index * 100);
                });
            }, 50);

        }



        /* Fixed Separation: Show Programme opens a NEW distinct modal */
        function showProgramme2026() {
            // 1. Close the current Diagnostic popup first
            closePopupCiblage();

            const modal = document.getElementById('programmePopup');
            const body = document.getElementById('prog-popup-body');
            const headerContainer = document.querySelector('#programmePopup .modal-header');

            // 2. Setup Header - Red Theme & Health Icon
            headerContainer.innerHTML = `
                <div class="header-titles">
                    <div style="display:flex; align-items:center; gap:12px;">
                        <div style="background:rgba(255,255,255,0.2); padding:8px; border-radius:10px;">
                            <i class="fa-solid fa-heart-pulse" style="font-size:1.4rem;"></i>
                        </div>
                        <span class="top-tag" style="font-size:1.1rem; font-weight:800; text-transform:uppercase; letter-spacing:3px;">Santé</span>
                    </div>
                </div>
                <span class="close-modal" onclick="closeProgrammePopup()" style="font-size:2rem; cursor:pointer; opacity:0.8; transition:0.3s;">&times;</span>
            `;

            // Style Header - Premium Red Gradient
            headerContainer.style.background = "linear-gradient(135deg, #9f1239 0%, #e11d48 100%)";
            headerContainer.style.padding = "20px 40px";
            headerContainer.style.color = "white";
            headerContainer.style.display = "flex";
            headerContainer.style.justifyContent = "space-between";
            headerContainer.style.alignItems = "center";
            headerContainer.style.boxShadow = "0 4px 20px rgba(159, 18, 57, 0.3)";

            const contentBox = document.getElementById('prog-modal-content');
            contentBox.style.maxWidth = "1150px";
            contentBox.style.borderRadius = "24px";
            contentBox.style.overflow = "hidden";
            contentBox.style.border = "1px solid rgba(255,255,255,0.5)";

            let html = `
                <style>
                    /* Custom Scrollbar Hide */
                    #prog-modal-content::-webkit-scrollbar {
                        display: none;
                    }
                    #prog-modal-content {
                        -ms-overflow-style: none;
                        scrollbar-width: none;
                    }

                    .prog-sub-container {
                        padding: 35px 45px;
                        background: #fff1f2; /* Light Red tint background */
                        position: relative;
                        overflow: hidden;
                        height: 100%;       /* Ensure full height */
                        overflow-y: auto;   /* Scroll inside here if needed */
                        /* Hide Scrollbar here too if it appears */
                        scrollbar-width: none; 
                    }
                    .prog-sub-container::-webkit-scrollbar { 
                        display: none; 
                    }
                    
                    /* Decorative background element */
                    .prog-sub-container::before {
                        content: '';
                        position: absolute;
                        top: 0; right: 0;
                        width: 300px; height: 300px;
                        background: radial-gradient(circle, rgba(225, 29, 72, 0.08) 0%, transparent 70%);
                        pointer-events: none;
                    }

                    .prog-title-banner {
                        background: white;
                        color: #881337;
                        text-align: left;
                        padding: 20px 30px;
                        font-size: 1.4rem;
                        font-weight: 800;
                        margin-bottom: 30px;
                        box-shadow: 0 10px 30px rgba(190, 18, 60, 0.08);
                        border-radius: 16px;
                        border-left: 8px solid #e11d48;
                        display: flex;
                        align-items: center;
                        gap: 15px;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                        animation: slideDownFade 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
                    }

                    @keyframes slideDownFade {
                        from { opacity: 0; transform: translateY(-20px); }
                        to { opacity: 1; transform: translateY(0); }
                    }

                    .custom-table-2026 {
                        width: 100%;
                        border-collapse: separate;
                        border-spacing: 0 10px; /* Spaced rows */
                    }

                    .custom-table-2026 thead th {
                        color: #9f1239;
                        padding: 0 20px 15px 20px;
                        text-align: left;
                        font-size: 0.85rem;
                        font-weight: 800;
                        text-transform: uppercase;
                        letter-spacing: 1px;
                        opacity: 0.8;
                    }
                    
                    /* Card-like Rows */
                    .custom-table-2026 tbody tr {
                        background: white;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.03);
                        transition: all 0.3s ease;
                        opacity: 0;
                        animation: fadeInUpRow 0.5s ease forwards;
                        cursor: default;
                    }
                    
                    .custom-table-2026 tbody tr:hover {
                        transform: translateY(-3px) scale(1.005);
                        box-shadow: 0 8px 25px rgba(225, 29, 72, 0.1);
                        z-index: 10;
                    }

                    .custom-table-2026 tbody td {
                        padding: 20px;
                        vertical-align: middle;
                        font-size: 0.95rem;
                        color: #334155;
                        font-weight: 600;
                        border-top: 1px solid rgba(226, 232, 240, 0.6);
                        border-bottom: 1px solid rgba(226, 232, 240, 0.6);
                    }
                    
                    .custom-table-2026 tbody td:first-child {
                        border-left: 1px solid rgba(226, 232, 240, 0.6);
                        border-top-left-radius: 12px;
                        border-bottom-left-radius: 12px;
                        border-left: 4px solid #fb7185; /* Accent left border */
                    }
                    
                    .custom-table-2026 tbody td:last-child {
                        border-right: 1px solid rgba(226, 232, 240, 0.6);
                        border-top-right-radius: 12px;
                        border-bottom-right-radius: 12px;
                    }

                    @keyframes fadeInUpRow {
                        from { opacity: 0; transform: translateY(20px); }
                        to { opacity: 1; transform: translateY(0); }
                    }

                    /* Pills */
                    .pill-commune {
                        display: inline-flex;
                        align-items: center;
                        gap: 8px;
                        background: #fff1f2;
                        color: #9f1239;
                        padding: 6px 14px;
                        border-radius: 50px;
                        font-weight: 700;
                        font-size: 0.85rem;
                        border: 1px solid #fecdd3;
                        white-space: nowrap; /* Prevent line break for Tan-Tan */
                    }
                    
                    .pill-cost-red {
                        display: inline-flex;
                        justify-content: center;
                        align-items: center;
                        width: 45px;
                        height: 45px;
                        background: #fff5f5;
                        color: #be123c;
                        border-radius: 12px;
                        font-weight: 900;
                        font-size: 1.1rem;
                        box-shadow: 0 4px 10px rgba(190, 18, 60, 0.1);
                        border: 2px solid #fecdd3;
                    }

                    .obj-list-custom {
                        margin: 0;
                        padding-left: 20px;
                        list-style-type: none;
                    }
                    .obj-list-custom li {
                        margin-bottom: 6px;
                        position: relative;
                        color: #475569;
                    }
                    .obj-list-custom li::before {
                        content: '•';
                        color: #e11d48;
                        font-weight: bold;
                        display: inline-block; 
                        width: 1em;
                        margin-left: -1em;
                    }

                    /* Total Row - IN TABLE FOOTER NOW */
                    .custom-table-2026 tfoot tr {
                        /* background: linear-gradient(135deg, #be123c 0%, #e11d48 100%); */
                         /* No background for row, use cells or spacing? 
                            User wants just "40" under column. 
                            Let's style it transparent but text bold. 
                         */
                         background: transparent;
                    }
                    
                    .custom-table-2026 tfoot td {
                        padding-top: 20px; 
                        border: none !important;
                    }

                    .total-label-cell {
                        text-align: right;
                        padding-right: 20px;
                        font-size: 1.4rem;
                        font-weight: 900;
                        text-transform: uppercase;
                        letter-spacing: 2px;
                        color: #be123c;
                    }
                    
                    /* The floating card effect for the specific Total Number Cell */
                    .total-num-card {
                        background: linear-gradient(135deg, #be123c 0%, #e11d48 100%);
                        color: white;
                        padding: 15px 10px;
                        border-radius: 16px;
                        font-size: 1.8rem;
                        font-weight: 900;
                        text-align: center;
                        box-shadow: 0 10px 25px rgba(190, 18, 60, 0.3);
                        display: block;
                        width: 100%;
                    }

                    /* Back Button */
                    .btn-back-wrap {
                        margin-top: 30px;
                    }
                    .btn-back-custom {
                        background: white;
                        border: none;
                        padding: 12px 30px;
                        border-radius: 50px;
                        color: #64748b;
                        font-weight: 700;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        transition: all 0.3s;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
                    }
                    .btn-back-custom:hover {
                        background: #fff1f2;
                        color: #be123c;
                        transform: translateX(-5px);
                        box-shadow: 0 8px 20px rgba(190, 18, 60, 0.1);
                    }
                </style>

                <div class="prog-sub-container">
                    
                    <div class="prog-title-banner">
                        <i class="fa-solid fa-file-signature"></i>
                        Programme prioritaire au titre de l’année 2026
                    </div>

                    <!-- Table -->
                    <table class="custom-table-2026">
                        <thead>
                            <tr>
                                <th width="30%">Projet</th>
                                <th width="15%">Commune</th>
                                <th width="15%" style="text-align:center;">Coût (Mdhs)</th>
                                <th width="40%">Objectifs</th>
                            </tr>
                        </thead>
                       <tbody>
    <tr style="animation-delay: 0.1s">
        <td style="font-weight:700; color:#000000;">Achat d'équipements médicaux pour le CHP</td>
        <td><span class="pill-commune" style="font-weight:700; color:#000000;"><i class="fa-solid fa-location-dot"></i> Tan-Tan</span></td>
        <td align="center"><div class="pill-cost-red" style="font-weight:700; color:red;">10</div></td>
        <td style="color:#000000;"><li>Amélioration de l'offre des soins médicaux</li></td>
    </tr>
    
    <tr style="animation-delay: 0.2s">
        <td style="font-weight:700; color:#000000;">Construction et équipement du CDTMR</td>
        <td><span class="pill-commune" style="font-weight:700; color:#000000;"><i class="fa-solid fa-location-dot"></i> Tan-Tan</span></td>
        <td align="center"><div class="pill-cost-red" style="font-weight:700; color:red;">10</div></td>
        <td style="color:#000000;">
            <li>Lutte contre la tuberculose</li>
            <li>Réduction de la transmission des maladies.</li>
            <li>Amélioration de la santé publique.</li>
        </td>
    </tr>
    
    <tr style="animation-delay: 0.3s">
        <td style="font-weight:700; color:#000000;">Acquisition de 04 ambulances</td>
        <td><span class="pill-commune" style="font-weight:700; color:#000000;"><i class="fa-solid fa-location-dot"></i> Tan-Tan</span></td>
        <td align="center"><div class="pill-cost-red" style="font-weight:700; color:red;">02</div></td>
        <td style="color:#000000;">
            <li>Augmentation de l'Efficacité Opérationnelle</li>
            <li>Expansion de la Couverture Géographique</li>
        </td>
    </tr>
    
    <tr style="animation-delay: 0.4s">
        <td style="font-weight:700; color:#000000;">Equipement du centre d'hémodialyse</td>
        <td><span class="pill-commune" style="font-weight:700; color:#000000;"><i class="fa-solid fa-location-dot"></i> Tan-Tan</span></td>
        <td align="center"><div class="pill-cost-red" style="font-weight:700; color:red;">04</div></td>
        <td style="color:#000000;">
            <li>Amélioration des soins de santé au profit des patients souffrant de l'insuffisance rénale</li>
        </td>
    </tr>

    <tr style="animation-delay: 0.5s">
        <td style="font-weight:700; color:#000000;">Construction et équipement d'un centre de santé</td>
        <td><span class="pill-commune" style="font-weight:700; color:#000000;"><i class="fa-solid fa-location-dot"></i> Tan-Tan</span></td>
        <td align="center"><div class="pill-cost-red" style="font-weight:700; color:red;">09</div></td>
        <td style="color:#000000;">
            <li>Améliorer l'accessibilité aux soins de santé de proximité</li>
        </td>
    </tr>
    
    <tr style="animation-delay: 0.6s">
        <td style="font-weight:700; color:#000000;">Construction des logements au profit du personnel médical</td>
        <td><span class="pill-commune" style="font-weight:700; color:#000000;"><i class="fa-solid fa-location-dot"></i> Tan-Tan</span></td>
        <td align="center"><div class="pill-cost-red" style="font-weight:700; color:red;">07</div></td>
        <td style="color:#000000;">
            <li>Amélioration de l'attractivité du personnel médical</li>
        </td>
    </tr>

    
                        
                              <tr class="prog-row" style="background:var(--primary); color:white; font-weight:900; animation: staggerIn 0.5s ease 1s forwards; opacity:0; transform:translateY(20px);">
                                <td class="prog-cell" style="color:white; text-align:center;">Total</td>
                                <td class="prog-cell" style="color:white;"></td>
                                <td class="prog-cell" style="color:white; text-align:center;"><div style="display:inline-flex; border:2px solid rgba(255,255,255,0.4); padding: 5px 15px; border-radius:10px; background:rgba(255,255,255,0.1);">42</div></td>
                                <td class="prog-cell" style="color:white; text-align:center;"></td>

                             </tr>
                        
                    </table>
                    <!-- Total Bar - MOVED TO TABLE FOOTER FOR ALIGNMENT -->
                    <!-- <div class="total-bar-block"> REMOVED </div> -->

                    <div class="btn-back-wrap">
                        <button onclick="backToDiag()" class="btn-back-custom">
                            <i class="fa-solid fa-arrow-left"></i> Retourner au Diagnostic
                        </button>
                    </div>
                </div>
            `;

            body.innerHTML = html;
            modal.style.display = 'flex'; // Make visible

            // Trigger Fade In
            setTimeout(() => {
                modal.classList.add('active');
            }, 10);
        }

        function closeProgrammePopup() {
            const modal = document.getElementById('programmePopup');
            modal.classList.remove('active');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 500);
        }

        function backToDiag() {
            closeProgrammePopup();
            showCiblage(); // Re-open the diag popup
        }



        function isolateGroup(zone) {
            zone === 'rural' ? showRuralLeft() : showUrbainLeft();
            document.getElementById('map-overlay').classList.add('active');
            document.getElementById('map-detail').style.filter = "blur(10px)";
            const svg = document.getElementById('isolated-svg');
            svg.innerHTML = "";
            let combinedBounds = null;

            Object.keys(layersMap).forEach(name => {
                const layer = layersMap[name];
                const bbox = layer._path.getBBox();
                if (!combinedBounds) combinedBounds = { x: bbox.x, y: bbox.y, r: bbox.x + bbox.width, b: bbox.y + bbox.height };
                else {
                    combinedBounds.x = Math.min(combinedBounds.x, bbox.x); combinedBounds.y = Math.min(combinedBounds.y, bbox.y);
                    combinedBounds.r = Math.max(combinedBounds.r, bbox.x + bbox.width); combinedBounds.b = Math.max(combinedBounds.b, bbox.y + bbox.height);
                }
            });

            Object.keys(layersMap).forEach(name => {
                const layer = layersMap[name];
                const isTarget = (zone === 'rural' ? ruralNames.includes(name) : urbainNames.includes(name));
                if (!isTarget) {
                    const ctx = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    ctx.setAttribute("d", layer._path.getAttribute('d'));
                    ctx.setAttribute("fill", "#ffffff"); ctx.setAttribute("stroke", "#94a3b8"); ctx.setAttribute("stroke-width", "0.5");
                    ctx.style.opacity = "0.7"; svg.appendChild(ctx);
                }
            });

            Object.keys(layersMap).forEach(name => {
                const layer = layersMap[name];
                const isTarget = (zone === 'rural' ? ruralNames.includes(name) : urbainNames.includes(name));
                if (isTarget) {
                    const bbox = layer._path.getBBox();
                    const centerX = bbox.x + bbox.width / 2;
                    const centerY = bbox.y + bbox.height / 2;

                    const trace = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    trace.setAttribute("d", layer._path.getAttribute('d'));
                    trace.setAttribute("fill", "#e2e8f0"); trace.setAttribute("stroke", "#94a3b8");
                    trace.setAttribute("stroke-width", "0.5"); svg.appendChild(trace);

                    const p = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    p.setAttribute("d", layer._path.getAttribute('d'));
                    let pathColor = "var(--color-rural)";
                    if (name === 'Tan-Tan' || name === 'El Ouatia') pathColor = "var(--color-urbain)";
                    p.setAttribute("fill", pathColor);
                    p.setAttribute("stroke", "#ffffff"); p.setAttribute("stroke-width", "1.5");
                    p.setAttribute("id", `path-${name.replace(/\s+/g, '-')}`);
                    p.setAttribute("class", "isolated-path");
                    p.style.transformOrigin = `${centerX}px ${centerY}px`;
                    svg.appendChild(p);

                    const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    t.setAttribute("x", centerX); t.setAttribute("y", centerY + 5); t.setAttribute("text-anchor", "middle");
                    t.setAttribute("fill", "#000"); t.setAttribute("stroke", "#fff"); t.setAttribute("stroke-width", "3");
                    t.setAttribute("paint-order", "stroke"); t.setAttribute("font-size", "11"); t.setAttribute("font-weight", "900");
                    t.textContent = name; svg.appendChild(t);
                }
            });

            if (combinedBounds) svg.setAttribute('viewBox', `${combinedBounds.x - 20} ${combinedBounds.y - 20} ${combinedBounds.r - combinedBounds.x + 40} ${combinedBounds.b - combinedBounds.y + 40}`);
            document.getElementById('isolated-box').classList.add('active');
            setTimeout(() => { document.querySelectorAll('.isolated-path').forEach(p => p.classList.add('pop-active')); }, 100);
        }



        const files = [{ f: "abteh.geojson", n: "Abteh" }, { f: "benkhlil.geojson", n: "Ben Khelil" }, { f: "chbika.geojson", n: "Chbika" }, { f: "commun tantan.geojson", n: "Tan-Tan" }, { f: "elouatia.geojson", n: "El Ouatia" }, { f: "msied.geojson", n: "Msied" }, { f: "tilemzoun.geojson", n: "Tilemzoun" }];
        const group = new L.FeatureGroup().addTo(map);
        files.forEach(item => {
            fetch(item.f).then(r => r.json()).then(data => {
                const l = L.geoJSON(data, {
                    style: { color: "rgba(255,255,255,0.8)", weight: 2, fillColor: "var(--primary)", fillOpacity: 0.15 }
                }).addTo(group);
                layersMap[item.n] = l.getLayers()[0];
                if (Object.keys(layersMap).length === files.length) {
                    map.fitBounds(group.getBounds(), { padding: [50, 50] });
                }
            });
        });
    </script>
</body>

</html>