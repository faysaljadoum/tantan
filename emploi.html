<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <title>Emploi - Province de Tan-Tan</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --primary: #a2466c;
      /* Dusty Violet/Mauve from image */
      --primary-dark: #7d3350;
      --accent: #d199b0;
      /* Lighter shade from image */
      --glass: rgba(255, 255, 255, 0.8);
      --glass-strong: rgba(255, 255, 255, 0.95);
      --glass-border: rgba(255, 255, 255, 0.5);
      --shadow-wow: 0 25px 50px -12px rgba(162, 70, 108, 0.15);
      --glow-color: rgba(162, 70, 108, 0.4);
      --color-urbain: #a2466c;
      --color-rural: #d199b0;
      --alert-red: #e11d48;
      --bar-commune: #a2466c;
      --bar-region: #d199b0;
      --bar-national: #94a3b8;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: #f1f5f9;
      color: #0f172a;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* --- Master Background --- */
    .bg-master {
      position: fixed;
      inset: 0;
      background: url('img/sahara_maroc.jpeg') center/cover no-repeat;
      z-index: -1;
      filter: saturate(0.9) brightness(1);
      animation: bgPan 80s infinite alternate linear;
    }

    .bg-overlay {
      position: fixed;
      inset: 0;
      background: rgba(241, 245, 249, 0.88);
      backdrop-filter: blur(12px);
      z-index: -1;
    }

    @keyframes bgPan {
      from {
        transform: scale(1);
      }

      to {
        transform: scale(1.15) translate(-2%, -1%);
      }
    }

    /* --- Premium Header --- */
    header {
      padding: 15px 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 40px;
      position: relative;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(20px);
      border-bottom: 2px solid rgba(30, 58, 138, 0.1);
      z-index: 2000;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.05);
      animation: slideDown 1.2s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    .header-center {
      text-align: center;
    }

    .pdti-subtitle {
      font-size: 1.1rem;
      font-weight: 800;
      background: linear-gradient(90deg, #a2466c, #d199b0, #a2466c);
      background-size: 200% auto;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shineText 4s linear infinite;
      letter-spacing: 0.5px;
      margin-bottom: 2px;
    }

    @keyframes shineText {
      to {
        background-position: 200% center;
      }
    }

    @keyframes slideDown {
      from {
        transform: translateY(-100%);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .maroc-separator {
      display: flex;
      align-items: center;
      gap: 20px;
      justify-content: center;
    }

    .province-text {
      font-weight: 900;
      text-transform: uppercase;
      font-size: 1.3rem;
      color: #5a2a3f;
      letter-spacing: 3px;
    }

    .line {
      height: 2px;
      background: linear-gradient(to right, transparent, var(--accent), transparent);
      flex: 1;
      width: 100px;
      opacity: 0.6;
    }

    .logo-box {
      width: 75px;
      height: 75px;
      background: rgba(162, 70, 108, 0.1);
      border: 2px solid rgba(162, 70, 108, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow: 0 8px 20px rgba(234, 88, 12, 0.1);
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      cursor: pointer;
      z-index: 2;
    }

    .logo-box:hover {
      transform: scale(1.1) rotate(5deg);
      box-shadow: 0 15px 30px rgba(209, 153, 176, 0.3);
      background: rgba(255, 255, 255, 1);
    }

    .logo-box img {
      width: 75%;
      height: auto;
      object-fit: contain;
    }

    .header-actions {
      position: absolute;
      right: 40px;
      display: flex;
      gap: 15px;
      align-items: center;
    }

    /* Circular Icon Buttons */
    .btn-icon-circle {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      background: white;
      color: #f3a20d;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      font-size: 1.3rem;
    }

    .btn-icon-circle:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .btn-icon-circle.btn-home {
      color: #a2466c;
    }

    .btn-icon-circle.btn-diagnostic {
      color: #b33c6e;
    }

    .btn-icon-circle.btn-synthese {
      color: #b33c6e;
    }

    .btn-icon-circle.btn-reset {
      color: #a2466c;
    }

    .btn-premium {
      background: var(--primary);
      color: white;
      padding: 10px 20px;
      border-radius: 50px;
      border: none;
      font-weight: 700;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(30, 58, 138, 0.2);
    }

    .btn-premium:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(162, 70, 108, 0.3);
      background: #a2466c;
    }

    /* --- Layout --- */
    .middle-container {
      flex: 1;
      display: flex;
      padding: 20px 30px;
      gap: 20px;
      overflow: hidden;
      position: relative;
    }

    .side-panel {
      width: 350px;
      position: relative;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 15px;
      padding: 25px 20px;
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(25px);
      border: 1px solid var(--glass-border);
      border-radius: 35px;
      box-shadow: var(--shadow-wow);
      overflow-y: auto;
      scrollbar-width: none;
      animation: slideInLeft 1s cubic-bezier(0.16, 1, 0.3, 1) backwards;
    }

    .side-panel.panel-right {
      animation: slideInRight 1s cubic-bezier(0.16, 1, 0.3, 1) backwards;
    }

    @keyframes slideInLeft {
      from {
        transform: translateX(-100px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .side-panel::-webkit-scrollbar {
      display: none;
    }

    #map-container {
      flex-grow: 1;
      position: relative;
      border-radius: 35px;
      overflow: hidden;
      box-shadow: var(--shadow-wow);
      border: 1px solid var(--glass-border);
      background: white;
    }

    #map-detail {
      width: 100%;
      height: 100%;
      transition: filter 0.5s ease;
    }

    /* --- Cards & UI --- */
    .ui-card {
      background: white;
      border-radius: 24px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.02);
      border: 1px solid rgba(0, 0, 0, 0.03);
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      cursor: pointer;
      animation: cardFadeIn 0.8s ease backwards;
      margin-bottom: 10px;
    }

    @keyframes cardFadeIn {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
        filter: blur(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0);
      }
    }

    .ui-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 40px rgba(162, 70, 108, 0.15);
      border-color: var(--primary);
    }

    .card-profile-header {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      padding: 15px;
      margin: -10px auto 25px auto;
      width: 90%;
      border-radius: 50px;
      font-weight: 900;
      font-size: 0.85rem;
      text-transform: uppercase;
      color: white;
      text-align: center;
      box-shadow: 0 10px 20px rgba(162, 70, 108, 0.2);
    }

    .card-footer-tip {
      margin-top: 15px;
      padding: 10px;
      border: 2px dashed rgba(162, 70, 108, 0.2);
      border-radius: 15px;
      text-align: center;
      font-size: 0.7rem;
      font-weight: 800;
      color: #64748b;
      text-transform: uppercase;
    }

    .indicator-row {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 20px;
      opacity: 0;
      transform: translateX(-20px);
      animation: indicatorEntrance 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes indicatorEntrance {
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .indicator-icon {
      width: 45px;
      height: 45px;
      background: rgba(162, 70, 108, 0.08);
      border: 1px solid rgba(162, 70, 108, 0.15);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      font-size: 1.2rem;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      flex-shrink: 0;
    }

    .indicator-row:hover .indicator-icon {
      transform: scale(1.1) rotate(10deg);
      background: var(--primary);
      color: white;
    }

    .indicator-label {
      font-size: 0.95rem;
      font-weight: 700;
      color: #1e293b;
      line-height: 1.4;
    }

    /* --- Emploi Specific Cards --- */
    .emp-card {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-radius: 18px;
      padding: 0;
      overflow: hidden;
      margin-bottom: 15px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
      transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .emp-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    .emp-title {
      font-weight: 900;
      font-size: 11px;
      text-transform: uppercase;
      color: #92400e;
      background: linear-gradient(to right, #fef3c7, #fde68a);
      padding: 15px 22px;
      border-bottom: 1px solid #fcd34d;
    }

    .emp-list {
      list-style: none;
      padding: 22px;
      margin: 0;
      font-size: 12px;
      color: #451a03;
      font-weight: 600;
      line-height: 1.6;
    }

    .emp-list li {
      margin-bottom: 8px;
      padding-left: 20px;
      position: relative;
    }

    .emp-list li::before {
      content: "➜";
      position: absolute;
      left: 0;
      color: #d97706;
      font-size: 10px;
      top: 1px;
    }

    .emp-card.green {
      background: #f0fdf4;
      border-color: #86efac;
    }

    .emp-card.green .emp-title {
      color: #166534;
      background: linear-gradient(to right, #dcfce7, #bbf7d0);
      border-bottom: 1px solid #86efac;
    }

    .emp-card.green .emp-list {
      color: #14532d;
    }

    .emp-card.green .emp-list li::before {
      color: #16a34a;
    }



    /* --- Charts (Modern Wow) --- */
    .chart-box {
      background: white;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.02);
      margin-bottom: 15px;
    }

    .chart-title {
      font-size: 0.8rem;
      font-weight: 800;
      color: var(--primary);
      text-transform: uppercase;
      margin-bottom: 15px;
      text-align: center;
    }

    .chart-flex-row {
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      height: 160px;
      gap: 5px;
      padding: 30px 5px 40px 5px;
      border-bottom: 1px solid #f1f5f9;
      position: relative;
    }

    .chart-col {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      position: relative;
    }

    /* Animation fluide pour les barres d'histogramme */
    .c-bar {
      transition: height 1.5s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 0.3s ease !important;
      position: relative;
      overflow: hidden;
    }

    .c-bar:hover {
      filter: brightness(1.2);
      cursor: pointer;
    }

    /* Effet de brillance sur les barres */
    .c-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to bottom, rgba(255, 255, 255, 0.2), transparent);
    }

    /* Animation des cercles de progression */
    .circular-progress {
      transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      animation: circleFill 1.5s ease-out forwards;
    }

    .circle-item:hover .circular-progress {
      transform: scale(1.1);
    }

    @keyframes circleFill {
      from {
        opacity: 0;
        transform: scale(0.8);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Animation pour les cartes de diagnostic et synthèse */
    .diag-card {
      opacity: 0;
      transform: translateY(20px);
      animation: slideInUp 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
      transition: all 0.3s ease;
    }

    .diag-card:hover {
      transform: translateX(10px) scale(1.02);
      box-shadow: 10px 10px 20px rgba(0, 0, 0, 0.1);
    }

    @keyframes slideInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .c-bar {
      width: 16px;
      border-radius: 4px 4px 0 0;
      background: var(--primary);
      transition: height 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.2);
      position: relative;
    }

    .c-value {
      position: absolute;
      top: -22px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.65rem;
      font-weight: 900;
      color: #0f172a;
      opacity: 0;
      transition: opacity 0.5s 0.8s;
    }

    .c-label {
      font-size: 0.65rem;
      font-weight: 800;
      color: #475569;
      margin-top: 10px;
      transform: rotate(-45deg);
      white-space: nowrap;
      position: absolute;
      bottom: -35px;
    }

    /* --- Filters --- */
    .filter-container-left {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 15px;
    }

    .btn-filter-left {
      flex: 1;
      background: white;
      border: 1px solid var(--glass-border);
      padding: 15px;
      border-radius: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-size: 0.75rem;
      font-weight: 800;
      text-transform: uppercase;
      transition: all 0.3s;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
    }

    .btn-filter-left:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.05);
      border-color: var(--accent);
    }

    .filter-row {
      display: flex;
      gap: 10px;
    }

    .btn-commune-urbaine {
      flex: 1;
      background: white;
      border: 1.5px solid var(--primary);
      color: var(--primary);
      padding: 12px 15px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 0.7rem;
      font-weight: 900;
      text-transform: uppercase;
      transition: all 0.3s;
      text-align: center;
    }

    .btn-commune-urbaine:hover,
    .btn-commune-urbaine.active {
      background: var(--primary);
      color: white;
    }

    /* --- Navigation --- */
    .bottom-nav {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2000;
      display: flex;
      gap: 15px;
      background: rgba(226, 232, 240, 0.85);
      backdrop-filter: blur(20px);
      padding: 12px 30px;
      border-radius: 100px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.8);
      animation: slideUpNav 1.2s cubic-bezier(0.16, 1, 0.3, 1) 0.6s backwards;
    }

    @keyframes slideUpNav {
      from {
        transform: translate(-50%, 100px);
        opacity: 0;
      }

      to {
        transform: translate(-50%, 0);
        opacity: 1;
      }
    }

    .nav-btn {
      text-decoration: none;
      color: #334155;
      font-size: 0.75rem;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 10px 20px;
      border-radius: 50px;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      display: flex;
      align-items: center;
      gap: 10px;
      opacity: 0;
      animation: navBtnEntrance 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    @keyframes navBtnEntrance {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .nav-btn:nth-child(1) {
      animation-delay: 0.1s;
    }

    .nav-btn:nth-child(2) {
      animation-delay: 0.2s;
    }

    .nav-btn:nth-child(3) {
      animation-delay: 0.3s;
    }

    .nav-btn:nth-child(4) {
      animation-delay: 0.4s;
    }

    .nav-btn:nth-child(5) {
      animation-delay: 0.5s;
    }

    .nav-btn i {
      font-size: 1.1rem;
      color: #57595a;
      transition: transform 0.3s;
    }

    .nav-btn:hover i {
      transform: scale(1.2) rotate(10deg);
    }

    .nav-btn.active i,
    .nav-btn:hover,
    .nav-btn.active {
      background: rgba(162, 70, 108, 0.12);
      color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(162, 70, 108, 0.1);
    }

    .nav-btn.active {
      position: relative;
      background: rgba(162, 70, 108, 0.15);
      animation: navBtnEntrance 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards, activePillPulse 2s infinite;
    }

    @keyframes activePillPulse {
      0% {
        box-shadow: 0 5px 15px rgba(162, 70, 108, 0.2);
      }

      50% {
        box-shadow: 0 8px 25px rgba(162, 70, 108, 0.4);
      }

      100% {
        box-shadow: 0 5px 15px rgba(162, 70, 108, 0.2);
      }
    }

    /* --- Map Overlay & Isolation --- */
    #map-overlay {
      position: absolute;
      inset: 0;
      background: rgba(255, 255, 255, 0);
      pointer-events: none;
      z-index: 500;
      transition: 0.4s;
      border-radius: 35px;
    }

    #map-overlay.active {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(15px);
      pointer-events: auto;
    }

    #isolated-box {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      width: 80%;
      height: 80%;
      z-index: 600;
      pointer-events: none;
      opacity: 0;
      transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    }

    #isolated-box.active {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    #isolated-svg {
      width: 100%;
      height: 100%;
      filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.2));
    }

    .pop-active {
      animation: communePopOut 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      z-index: 100;
    }

    @keyframes communePopOut {
      0% {
        transform: translate(0, 0) scale(1);
        filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.2));
      }

      100% {
        transform: translate(-15px, -15px) scale(1.08);
        filter: drop-shadow(20px 20px 30px rgba(0, 0, 0, 0.4));
      }
    }

    .isolated-path {
      transition: all 0.4s;
      cursor: pointer;
    }

    /* Modals */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(10px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 5000;
    }

    .modal-content {
      background: white;
      border-radius: 35px;
      width: 120%;
      max-width: 1400px;
      overflow: hidden;
      box-shadow: var(--shadow-wow);
      transform: scale(0.9);
      animation: modalPop 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    @keyframes modalPop {
      from {
        transform: scale(0.9) translateY(30px);
        opacity: 0;
      }

      to {
        transform: scale(1) translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      color: white;
      padding: 25px 35px;
      font-weight: 800;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      overflow: hidden;
    }

    .modal-header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% {
        transform: translateX(-100%) translateY(-100%) rotate(45deg);
      }

      100% {
        transform: translateX(100%) translateY(100%) rotate(45deg);
      }
    }

    .modal-body {
      padding: 40px;
      overflow-y: auto;
      max-height: 80vh;
    }

    .ciblage-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .ciblage-col {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .ciblage-title {
      font-size: 1rem;
      font-weight: 900;
      color: #fff;
      text-transform: uppercase;
      text-align: center;
      border-radius: 14px;
      padding: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      background: var(--primary);
      opacity: 0;
      transform: translateY(-20px);
      animation: slideDownTitle 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    @keyframes slideDownTitle {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .diag-card {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px 20px;
      border-radius: 15px;
      background: white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.02);
      border-left: 6px solid #ccc;
      opacity: 0;
      transform: translateX(-20px);
      animation: slideInDiag 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      transition: all 0.3s ease;
    }

    @keyframes slideInDiag {
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .diag-card:hover {
      transform: translateX(5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    }

    .diag-prob {
      background: linear-gradient(135deg, #fff5f5 0%, #ffe4e6 100%);
      border-left-color: #a41c1c;
    }

    .diag-prob:hover {
      background: linear-gradient(135deg, #ffe4e6 0%, #fecdd3 100%);
    }

    .diag-target {
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      border-left-color: #1c7430;
    }

    .diag-target:hover {
      background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
    }

    .diag-icon {
      width: 45px;
      height: 45px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      flex-shrink: 0;
      transition: all 0.3s ease;
    }

    .diag-prob .diag-icon {
      background: rgba(164, 28, 28, 0.1);
      color: #a41c1c;
    }

    .diag-target .diag-icon {
      background: rgba(28, 116, 48, 0.1);
      color: #1c7430;
    }

    .diag-card:hover .diag-icon {
      transform: scale(1.1) rotate(5deg);
    }

    .diag-text {
      font-size: 1.0rem;
      font-weight: 700;
      color: #1e293b;
      flex: 1;
    }

    /* Style spécifique pour les cercles de progression de l'image 2 */
    .circle-container {
      display: flex;
      justify-content: space-around;
      gap: 10px;
      margin-bottom: 20px;
    }

    .circle-item {
      text-align: center;
      flex: 1;
    }

    .circular-progress {
      position: relative;
      width: 60px;
      height: 70px;
      border-radius: 50%;
      background: conic-gradient(var(--primary) calc(var(--percent) * 1%), #e2e8f0 0);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 8px;
    }

    .circular-progress::before {
      content: "";
      position: absolute;
      width: 55px;
      height: 55px;
      background: white;
      border-radius: 50%;
    }

    .circle-value {
      position: relative;
      font-weight: 900;
      font-size: 0.75rem;
      color: var(--primary);
    }

    .circle-label {
      font-size: 0.65rem;
      font-weight: 800;
      color: #475569;
      text-transform: uppercase;
    }
  </style>
</head>

<body>

  <div class="bg-master"></div>
  <div class="bg-overlay"></div>

  <header>
    <div class="logo-box" onclick="location.href='index.html'">
      <img src="img/logo_french.png" alt="Logo">
    </div>
    <div class="header-center">
      <div class="pdti-subtitle">PDTI Tan-Tan | Vers un territoire inclusif, durable et attractif</div>
      <div class="maroc-separator">
        <span class="line"></span>
        <span class="province-text">AXE EMPLOI</span>
        <span class="line"></span>
      </div>
    </div>
    <div class="logo-box" onclick="location.href='index.html'">
      <img src="img/logo_arabe.png" alt="Logo">
    </div>
    <div class="header-actions">
      <button onclick="showCiblage()" class="btn-icon-circle btn-diagnostic" title="Diagnostic">
        <i class="fa-solid fa-bullseye"></i>
      </button>
      <button onclick="showSynthese(1)" class="btn-icon-circle btn-synthese" title="Synthèse Éco">
        <i class="fa-solid fa-chart-pie"></i>
      </button>
      <button onclick="location.href='tantan.html'" class="btn-icon-circle btn-home" title="Accueil">
        <i class="fa-solid fa-home"></i>
      </button>
      <button onclick="location.reload()" class="btn-icon-circle btn-reset" title="Réinitialiser">
        <i class="fa-solid fa-rotate"></i>
      </button>
    </div>

  </header>

  <div class="middle-container">
    <div class="side-panel" id="panel-left">
      <div class="filter-container-left">
        <div class="filter-row">
          <button class="btn-filter-left" onclick="isolateGroup('urbain')">
            <div style="width:12px; height:12px; border-radius:50%; background: var(--color-urbain);"></div>
            Urbain
          </button>
          <button class="btn-filter-left" onclick="isolateGroup('rural')">
            <div style="width:12px; height:12px; border-radius:50%; background: var(--color-rural);"></div>
            Rural
          </button>
        </div>
        <div id="sub-filter-urbain" class="filter-row" style="display: none; margin-top: 5px;">
          <button class="btn-commune-urbaine" id="btn-tantan" onclick="showTanTanDetails()">Tan-Tan</button>
          <button class="btn-commune-urbaine" id="btn-elouatia" onclick="showElOuatiaDetails()">El Ouatia</button>
        </div>
      </div>
      <div id="panel-left-content"></div>
    </div>

    <div id="map-container">
      <div id="map-detail"></div>
      <div id="map-overlay"></div>
      <div id="isolated-box"><svg id="isolated-svg" preserveAspectRatio="xMidYMid meet"></svg></div>
    </div>

    <div class="side-panel" id="panel-right">

    </div>
  </div>

  <div class="bottom-nav">
    <a href="education.html" class="nav-btn"><i class="fa-solid fa-graduation-cap"></i> ÉDUCATION</a>
    <a href="sante.html" class="nav-btn"><i class="fa-solid fa-hospital-user"></i> SANTÉ</a>
    <a href="eau.html" class="nav-btn"><i class="fa-solid fa-droplet"></i> EAU</a>
    <a href="mise_a_niveau.html" class="nav-btn"><i class="fa-solid fa-road"></i> MAN</a>
    <a href="emploi.html" class="nav-btn active"><i class="fa-solid fa-briefcase"></i> EMPLOI</a>
  </div>

  <div id="alertPopup" class="modal-overlay" onclick="closePopupCiblage()">
    <div class="modal-content" id="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <div><i class="fa-solid fa-triangle-exclamation"></i> <span id="popup-title">DIAGNOSTIC</span></div>
        <span class="close-modal" onclick="closePopupCiblage()" style="cursor:pointer; font-size: 2rem;">&times;</span>
      </div>
      <div class="modal-body" id="popup-body"></div>
    </div>
  </div>

  <div id="programmePopup" class="modal-overlay">
    <div class="modal-content" id="prog-modal-content">
      <div class="modal-header" style="background:#a2466c; color:white;">
        <!-- Header will be injected by JS -->
      </div>
      <div class="modal-body" id="prog-popup-body" style="padding:0;">
        <!-- Content will be injected by JS -->
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    var map = L.map("map-detail", { zoomControl: false, attributionControl: false });
    const ruralNames = ["Chbika", "Abteh", "Msied", "Tilemzoun", "Ben Khelil"];
    const urbainNames = ["Tan-Tan", "El Ouatia"];
    let layersMap = {};

    function highlightSVGCommune(name) {
      document.querySelectorAll('.isolated-path').forEach(p => p.classList.remove('pop-active'));
      const target = document.getElementById(`path-${name.replace(/\s+/g, '-')}`);
      if (target) target.classList.add('pop-active');
    }

    // --- FONCTION DE CHARGEMENT CORRIGÉE (STYLE IMAGE 2) ---
    function showDefaultProvinceData() {
      document.getElementById('panel-right').innerHTML = `
            <div class="ui-card">
                <div class="card-profile-header">Caractéristiques de l’emploi</div>
                <div class="indicator-row" style="animation-delay: 0.1s;">
                    <div class="indicator-icon"><i class="fa-solid fa-anchor"></i></div>
                    <div class="indicator-label">Dépendance du port de Tan-Tan</div>
                </div>
                <div class="indicator-row" style="animation-delay: 0.2s;">
                    <div class="indicator-icon"><i class="fa-solid fa-hand-holding-dollar"></i></div>
                    <div class="indicator-label">Précarité et informalité</div>
                </div>
                <div class="indicator-row" style="animation-delay: 0.3s;">
                    <div class="indicator-icon"><i class="fa-solid fa-user-graduate"></i></div>
                    <div class="indicator-label">Chômage des diplômés</div>
                </div>
            </div>
        `;

      document.getElementById('panel-left-content').innerHTML = `
            <div class="chart-box" style="animation: cardFadeIn 0.8s ease 0.2s backwards; cursor: pointer;" onclick="showGraphPopup('chomage-province')">
                <div class="chart-title">Taux de chômage (%)</div>
                <div class="chart-flex-row">
                    <div class="chart-col">
                        <div class="c-value">21.3%</div>
                        <div class="c-bar" style="height:0; background:#94a3b8;" data-height="60"></div>
                        <div class="c-label">National</div>
                    </div>
                    <div class="chart-col">
                        <div class="c-value">31.5%</div>
                        <div class="c-bar" style="height:0; background:var(--accent);" data-height="110"></div>
                        <div class="c-label">Région</div>
                    </div>
                    <div class="chart-col">
                        <div class="c-value">25.3%</div>
                        <div class="c-bar" style="height:0; background:var(--primary);" data-height="90"></div>
                        <div class="c-label">Province</div>
                    </div>
                </div>
            </div>
        `;

      setTimeout(() => {
        document.querySelectorAll('.c-bar').forEach(bar => {
          bar.style.height = bar.getAttribute('data-height') + "px";
        });
        document.querySelectorAll('.c-value').forEach(val => {
          val.style.opacity = "1";
        });
      }, 400);
    }

    // Gardez le reste de votre code identique (Leaflet, boutons, etc.)
    window.onload = showDefaultProvinceData;

    // --- RURAL FUNCTIONS ---

    function showRuralLeft() {
      document.getElementById('sub-filter-urbain').style.display = 'none';
      document.getElementById('panel-right').innerHTML = `
        <div class="ui-card">
          <div class="card-profile-header" style="background: linear-gradient(90deg, #a2466c, #d199b0);">Potentialités Économiques</div>
          <div class="indicator-row" style="animation-delay: 0.1s;">
            <div class="indicator-icon"><i class="fa-solid fa-wheat-awn"></i></div>
            <div class="indicator-label">Agriculture</div>
          </div>
          <div class="indicator-row" style="animation-delay: 0.2s;">
            <div class="indicator-icon"><i class="fa-solid fa-umbrella-beach"></i></div>
            <div class="indicator-label">Tourisme</div>
          </div>
          <div class="indicator-row" style="animation-delay: 0.3s;">
            <div class="indicator-icon"><i class="fa-solid fa-ship"></i></div>
            <div class="indicator-label">Pêche artisanale et aquaculture</div>
          </div>
          <div class="indicator-row" style="animation-delay: 0.4s;">
            <div class="indicator-icon"><i class="fa-solid fa-hand-holding-heart"></i></div>
            <div class="indicator-label">Artisanat et ESS</div>
          </div>
          <div class="indicator-row" style="animation-delay: 0.5s;">
            <div class="indicator-icon"><i class="fa-solid fa-bolt"></i></div>
            <div class="indicator-label">Énergies renouvelables</div>
          </div>
        </div>

        <div class="ui-card">
          <div class="card-profile-header" style="background: linear-gradient(90deg, #a2466c, #d199b0);">Caractéristiques de l’emploi</div>
          <div class="indicator-row" style="animation-delay: 0.6s;">
            <div class="indicator-icon"><i class="fa-solid fa-cow"></i></div>
            <div class="indicator-label">Dépendance de l’élevage</div>
          </div>
          <div class="indicator-row" style="animation-delay: 0.7s;">
            <div class="indicator-icon"><i class="fa-solid fa-cloud-sun"></i></div>
            <div class="indicator-label">Agriculture saisonnière</div>
          </div>
          <div class="indicator-row" style="animation-delay: 0.8s;">
            <div class="indicator-icon"><i class="fa-solid fa-person-walking-arrow-right"></i></div>
            <div class="indicator-label">Migration des actifs</div>
          </div>
        </div>
      `;
      showRuralGlobalDetails();
    }

    function showRuralGlobalDetails() {
      const chomageData = [
        { l: "National", v: 21.4, c: "#94a3b8" },
        { l: "Région", v: 38.2, c: "var(--accent)" },
        { l: "Province", v: 28.7, c: "var(--primary)" },
      ];

      let chomHtml = chomageData.map(d => `
        <div class="chart-col">
          <div class="c-value">${d.v}%</div>
          <div class="c-bar" style="height:0; background:${d.c};" data-height="${(d.v / 50) * 120}"></div>
          <div class="c-label">${d.l}</div>
        </div>`).join('');

      document.getElementById('panel-left-content').innerHTML = `
        <div class="chart-box" style="animation: cardFadeIn 0.8s ease backwards; cursor: pointer;" onclick="showGraphPopup('chomage-rural')">
          <div class="chart-title">TAUX DE CHÔMAGE MILIEU RURAL (%)</div>
          <div class="chart-flex-row">${chomHtml}</div>
        </div>
      `;

      setTimeout(() => {
        document.querySelectorAll('.c-bar').forEach(bar => {
          bar.style.height = bar.getAttribute('data-height') + "px";
        });
        document.querySelectorAll('.c-value').forEach(val => {
          val.style.opacity = "1";
        });
      }, 400);
    }



    // --- URBAIN FUNCTIONS ---

    function showUrbainLeft() {
      // Affiche les sous-filtres (Tan-Tan / El Ouatia)
      document.getElementById('sub-filter-urbain').style.display = 'flex';

      // Vide le panneau de droite (n'affiche rien)
      document.getElementById('panel-right').innerHTML = "";

      // Affiche uniquement les données du côté gauche
      document.getElementById('panel-left-content').innerHTML = `
    <div class="ui-card">
      <div class="card-profile-header" style="background: linear-gradient(90deg, #a2466c, #d199b0);">MILIEU URBAIN</div>
      <div class="indicator-row" style="animation-delay: 0.1s;">
        <div class="indicator-icon"><i class="fa-solid fa-city"></i></div>
        <div class="indicator-label">02 Communes urbaines</div>
      </div>
      <div class="indicator-row" style="animation-delay: 0.2s;">
        <div class="indicator-icon"><i class="fa-solid fa-users"></i></div>
        <div class="indicator-label">90 392 Habitants</div>
      </div>
    </div>
  `;
    }

    function showTanTanDetails() {
      highlightSVGCommune('Tan-Tan');
      document.querySelectorAll('.btn-commune-urbaine').forEach(b => b.classList.remove('active'));
      document.getElementById('btn-tantan').classList.add('active');

      document.getElementById('panel-right').innerHTML = `
    <div class="ui-card">
      <div class="card-profile-header">Caractéristiques de l’emploi (Tan-Tan)</div>
      <div class="indicator-row" style="animation-delay: 0.1s;">
        <div class="indicator-icon"><i class="fa-solid fa-anchor"></i></div>
        <div class="indicator-label">Dépendance du port de Tan-Tan</div>
      </div>
      <div class="indicator-row" style="animation-delay: 0.2s;">
        <div class="indicator-icon"><i class="fa-solid fa-calendar-alt"></i></div>
        <div class="indicator-label">Saisonnalité précarité et informalité</div>
      </div>
      <div class="indicator-row" style="animation-delay: 0.3s;">
        <div class="indicator-icon"><i class="fa-solid fa-user-graduate"></i></div>
        <div class="indicator-label">Chômage des jeunes et des diplômés </div>
      </div>
    </div>

    <div class="ui-card">
      <div class="card-profile-header">Potentialités Économiques</div>
      <div class="indicator-row" style="animation-delay: 0.4s;">
        <div class="indicator-icon"><i class="fa-solid fa-hammer"></i></div>
        <div class="indicator-label">Artisanat</div>
      </div>
      <div class="indicator-row" style="animation-delay: 0.5s;">
        <div class="indicator-icon"><i class="fa-solid fa-hand-holding-heart"></i></div>
        <div class="indicator-label">Économie sociale et solidaire</div>
      </div>
    </div>
  `;

      document.getElementById('panel-left-content').innerHTML = `
    <div class="chart-box" style="animation: cardFadeIn 0.8s ease backwards; cursor: pointer;" onclick="showGraphPopup('chomage-tantan')">
      <div class="chart-title">Taux de chômage (%)</div>
      <div class="chart-flex-row">
        <div class="chart-col">
          <div class="c-value">21,2%</div>
          <div class="c-bar" style="height:0; background:#94a3b8;" data-height="75"></div>
          <div class="c-label">National</div>
        </div>
        <div class="chart-col">
          <div class="c-value">25,2%</div>
          <div class="c-bar" style="height:0; background:var(--accent);" data-height="90"></div>
          <div class="c-label">Province</div>
        </div>
        <div class="chart-col">
          <div class="c-value">28%</div>
          <div class="c-bar" style="height:0; background:var(--primary);" data-height="110"></div>
          <div class="c-label">Ville Tan-Tan</div>
        </div>
      </div>
    </div>


    <div class="ui-card" style="padding: 10px;">
      <div style="background: #c00; color: white; text-align: center; padding: 10px; font-weight: bold; margin-bottom: 10px; border-radius: 5px;">
        Equipements économiques
      </div>
      <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem; text-align: left;">
        <thead>
          <tr style="background: #c00; color: white;">
            <th style="padding: 8px; border: 1px solid #ddd;">Type d’établissement</th>
            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">Nombre Actuel</th>
          </tr>
        </thead>
        <tbody>
          <tr><td style="padding: 6px; border: 1px solid #ddd;">Marché de proximité</td><td style="text-align: center; border: 1px solid #ddd;">04</td></tr>
          <tr style="background: #f9f9f9;"><td style="padding: 6px; border: 1px solid #ddd;">Zone d’activité économique</td><td style="text-align: center; border: 1px solid #ddd;">00</td></tr>
          <tr><td style="padding: 6px; border: 1px solid #ddd;">Zone d’activité artisanale</td><td style="text-align: center; border: 1px solid #ddd;">00</td></tr>
          <tr style="background: #f9f9f9;"><td style="padding: 6px; border: 1px solid #ddd;">Zone touristique</td><td style="text-align: center; border: 1px solid #ddd;">00</td></tr>
          <tr><td style="padding: 6px; border: 1px solid #ddd;">Plateforme des artisans</td><td style="text-align: center; border: 1px solid #ddd;">01</td></tr>
          <tr style="background: #f9f9f9;"><td style="padding: 6px; border: 1px solid #ddd;">Plateforme d’incubation</td><td style="text-align: center; border: 1px solid #ddd;">00</td></tr>
        </tbody>
      </table>
    </div>



    <div class="ui-card">
      
      <div class="indicator-row" style="animation-delay: 0.5s;">
        <div class="indicator-label"><li>Manque d’équipements économiques</li></div>
      </div>
      <div class="indicator-row" style="animation-delay: 0.5s;">
      <div class="indicator-label"><li>Tissu économique précaire</li></div>
      </div>
      <div class="indicator-row" style="animation-delay: 0.5s;">
      <div class="indicator-label"><li>Faible attractivité</li></div>
      </div>
      <div class="indicator-row" style="animation-delay: 0.5s;">
      <div class="indicator-label"><li>Faible capacité d’emploi</li></div>
      </div>
    </div>
  `;

      setTimeout(() => {
        document.querySelectorAll('.c-bar').forEach(bar => {
          bar.style.height = bar.getAttribute('data-height') + "px";
        });
        document.querySelectorAll('.c-value').forEach(val => {
          val.style.opacity = "1";
        });
      }, 400);
    }
    function showElOuatiaDetails() {
      highlightSVGCommune('El Ouatia');
      document.querySelectorAll('.btn-commune-urbaine').forEach(b => b.classList.remove('active'));
      document.getElementById('btn-elouatia').classList.add('active');

      document.getElementById('panel-right').innerHTML = `
       <div class="ui-card">
          <div class="card-profile-header">Caractéristiques de l’emploi (El Ouatia)</div>
          <div class="indicator-row" style="animation-delay: 0.1s;">
            <div class="indicator-icon"><i class="fa-solid fa-anchor"></i></div>
            <div class="indicator-label">Dépendance du port de Tan-Tan</div>
          </div>
          <div class="indicator-row" style="animation-delay: 0.2s;">
            <div class="indicator-icon"><i class="fa-solid fa-calendar-xmark"></i></div>
            <div class="indicator-label">Saisonnalité précarité et informalité</div>
          </div>
          <div class="indicator-row" style="animation-delay: 0.3s;">
            <div class="indicator-icon"><i class="fa-solid fa-graduation-cap"></i></div>
            <div class="indicator-label">Chômage des jeunes et des diplômés </div>
          </div>
        </div>

        <div class="ui-card">
          <div class="card-profile-header">Potentialités Économiques</div>
          <div class="indicator-row" style="animation-delay: 0.4s;">
            <div class="indicator-icon"><i class="fa-solid fa-umbrella-beach"></i></div>
            <div class="indicator-label">Tourisme balnéaire</div>
          </div>
          <div class="indicator-row" style="animation-delay: 0.5s;">
            <div class="indicator-icon"><i class="fa-solid fa-ship"></i></div>
            <div class="indicator-label">Pêche maritime</div>
          </div>
          <div class="indicator-row" style="animation-delay: 0.6s;">
            <div class="indicator-icon"><i class="fa-solid fa-hammer"></i></div>
            <div class="indicator-label">Artisanat</div>
            </div>
            <div class="indicator-row" style="animation-delay: 0.5s;">
        <div class="indicator-icon"><i class="fa-solid fa-hand-holding-heart"></i></div>
        <div class="indicator-label">Économie sociale et solidaire</div>
      </div>
        </div>

      `;

      document.getElementById('panel-left-content').innerHTML = `
    <div class="chart-box" style="animation: cardFadeIn 0.8s ease backwards; cursor: pointer;" onclick="showGraphPopup('chomage-elouatia')">
      <div class="chart-title">Taux de chômage (%)</div>
      <div class="chart-flex-row">
        <div class="chart-col">
          <div class="c-value">21,2%</div>
          <div class="c-bar" style="height:0; background:#94a3b8;" data-height="70"></div>
          <div class="c-label">National</div>
        </div>
        <div class="chart-col">
          <div class="c-value">29,2%</div>
          <div class="c-bar" style="height:0; background:var(--accent);" data-height="110"></div>
          <div class="c-label">Région</div>
        </div>
        <div class="chart-col">
          <div class="c-value">25,2%</div>
          <div class="c-bar" style="height:0; background:#72a8d3;" data-height="90"></div>
          <div class="c-label">Province</div>
        </div>
        <div class="chart-col">
          <div class="c-value">11,1%</div>
          <div class="c-bar" style="height:0; background:var(--primary);" data-height="35"></div>
          <div class="c-label">El Ouatia</div>
        </div>
      </div>
    </div>



  
    <div class="ui-card" style="padding: 10px;">
      <div style="background: #c00; color: white; text-align: center; padding: 10px; font-weight: bold; margin-bottom: 10px; border-radius: 5px;">
        Equipements économiques
      </div>
      <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem; text-align: left;">
        <thead>
          <tr style="background: #c00; color: white;">
            <th style="padding: 8px; border: 1px solid #ddd;">Type d’établissement</th>
            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">Nombre Actuel</th>
          </tr>
        </thead>
        <tbody>
          <tr><td style="padding: 6px; border: 1px solid #ddd;">Marché de proximité</td><td style="text-align: center; border: 1px solid #ddd;">00</td></tr>
          <tr style="background: #f9f9f9;"><td style="padding: 6px; border: 1px solid #ddd;">Zone d’activité économique</td><td style="text-align: center; border: 1px solid #ddd;">01</td></tr>
          <tr><td style="padding: 6px; border: 1px solid #ddd;">Zone d’activité artisanale</td><td style="text-align: center; border: 1px solid #ddd;">00</td></tr>
          <tr style="background: #f9f9f9;"><td style="padding: 6px; border: 1px solid #ddd;">Plateforme des artisans</td><td style="text-align: center; border: 1px solid #ddd;">00</td></tr>
          <tr><td style="padding: 6px; border: 1px solid #ddd;">Zone touristique</td><td style="text-align: center; border: 1px solid #ddd;">00</td></tr>
          <tr style="background: #f9f9f9;"><td style="padding: 6px; border: 1px solid #ddd;">Plateforme d’incubation</td><td style="text-align: center; border: 1px solid #ddd;">00</td></tr>
        </tbody>
      </table>
    </div>



    <div class="ui-card">
      
      <div class="indicator-row" style="animation-delay: 0.5s;">
        <div class="indicator-label"><li>Manque d’équipements économiques</li></div>
      </div>
      <div class="indicator-row" style="animation-delay: 0.5s;">
      <div class="indicator-label"><li>Tissu économique précaire</li></div>
      </div>
      <div class="indicator-row" style="animation-delay: 0.5s;">
      <div class="indicator-label"><li>Faible attractivité</li><div>
      </div><br>
      <div class="indicator-row" style="animation-delay: 0.5s;">
      <div class="indicator-label"><li>Faible capacité d’emploi</li></div>
      </div>
    </div>
  `;

      // Animation des barres
      setTimeout(() => {
        document.querySelectorAll('.c-bar').forEach(bar => {
          bar.style.height = bar.getAttribute('data-height') + "px";
        });
        document.querySelectorAll('.c-value').forEach(val => {
          val.style.opacity = "1";
        });
      }, 100);
    }

    // --- CIBLAGE MODAL ---

    function applyStaggerAnimation() {
      const cards = document.querySelectorAll('.diag-card');
      cards.forEach((card, index) => {
        card.style.animationDelay = (index * 0.1) + 's';
      });
    }

    const diagnosticData = [
      { icon: "fa-user-slash", prob: "Chômage élevé", target: "Réduire le taux de chômage de 25,3% à 15%" },
      { icon: "fa-person-digging", prob: "Précarité de l'emploi existant et absence de perspectives professionnelles dans le milieu rural", target: "Diversification des activités économiques<br>Soutien à l’entreprenariat et aux coopératives agricoles" },
      { icon: "fa-user-graduate", prob: "Chômage des jeunes et des diplômés", target: "Promotion de l’entreprenariat et de l’auto-emploi<br>Adaptation des compétences aux besoins du marché de l’emploi" },
      { icon: "fa-handshake-slash", prob: "Faible impact de l’économie sociale et solidaire sur l’emploi ", target: "Renforcement de l’économie sociale et solidaire<br>Soutien financier" },
      { icon: "fa-hammer", prob: "Précarité du secteur de l'artisanat", target: "Modernisation<br>Transmission des savoir faire et attractivité<br>Soutien financier" },
      { icon: "fa-umbrella-beach", prob: "Faible contribution du tourisme dans l’économie locale", target: "Valorisation du patrimoine local et des sites touristiques<br>Renforcement des capacités d’accueil " },
      { icon: "fa-fish", prob: "Faible valeur ajoutée locale du secteur de la pêche maritime", target: "Soutien aux unités de transformation des produits de la pêche <br> Soutien à la pêche artisanale" },
      { icon: "fa-industry", prob: "Activité industrielle en dessous des attentes", target: "Renforcement des plateformes industrielles et logistiques" }
    ];
    function showCiblage() {
      closeView();
      const body = document.getElementById('popup-body');
      const title = document.getElementById('popup-title');
      const modal = document.getElementById('modal-content');
      const header = document.querySelector('.modal-header');

      title.innerText = "DIAGNOSTIC & CIBLAGE - EMPLOI";

      // Premium Styling
      modal.style.maxWidth = "1100px";
      modal.style.borderRadius = "20px";
      header.style.background = "var(--primary)";

      let html = `
        <style>
            .ciblage-grid-new { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
            .diag-row-anim { 
                display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 12px;
                opacity: 0; transform: translateY(20px); transition: all 0.5s ease-out;
            }
            .diag-row-anim.active { opacity: 1; transform: translateY(0); }
            .diag-cell-premium {
                background: #fdf2f8; 
                border-radius: 50px; 
                padding: 10px 20px; 
                display: flex; 
                align-items: center; 
                gap: 15px;
                border-left: 6px solid var(--primary);
                box-shadow: 0 4px 6px rgba(0,0,0,0.02);
            }
            .diag-cell-target {
                background: #f0fdf4;
                border-left-color: #16a34a;
            }
            .header-pill-diag {
                padding: 12px; border-radius: 50px; text-align: center; color: white;
                font-weight: 800; font-size: 0.9rem; text-transform: uppercase;
            }
            .btn-next-float {
                position: absolute; bottom: 30px; right: 30px; width: 60px; height: 60px;
                background: var(--primary); color: white; border: 4px solid white;
                border-radius: 50%; display: flex; align-items: center; justify-content: center;
                font-size: 1.5rem; cursor: pointer; box-shadow: 0 10px 20px rgba(162, 70, 108, 0.3);
                transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 1000;
                animation: popIn 0.6s 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) backwards;
            }
            .btn-next-float:hover { transform: scale(1.1) rotate(-10deg); background: var(--primary-dark); }
            @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        </style>

        <div class="ciblage-grid-new">
            <div class="header-pill-diag" style="background:#a41c1c;">Problématiques</div>
            <div class="header-pill-diag" style="background:#16a34a;">Ciblage & Stratégie</div>
        </div>
        <div id="diag-rows-container">
      `;

      diagnosticData.forEach((item, index) => {
        html += `
            <div class="diag-row-anim" id="diag-row-${index}">
                <div class="diag-cell-premium">
                    <div style="width:35px; height:35px; border-radius:50%; background:white; display:flex; align-items:center; justify-content:center; color:var(--primary); font-size:0.9rem; flex-shrink:0; box-shadow:0 2px 4px rgba(0,0,0,0.1);">
                        <i class="fa-solid ${item.icon}"></i>
                    </div>
                    <div style="font-size:0.95rem; font-weight:700; color:#831843;">${item.prob}</div>
                </div>
                <div class="diag-cell-premium diag-cell-target">
                    <div style="width:35px; height:35px; border-radius:50%; background:white; display:flex; align-items:center; justify-content:center; color:#16a34a; font-size:0.9rem; flex-shrink:0; box-shadow:0 2px 4px rgba(0,0,0,0.1);">
                        <i class="fa-solid ${item.icon}"></i>
                    </div>
                    <div style="font-size:0.95rem; font-weight:700; color:#14532d;">${item.target}</div>
                </div>
            </div>
          `;
      });

   

      body.innerHTML = html;
      document.getElementById('alertPopup').style.display = 'flex';

      // Animate rows
      setTimeout(() => {
        diagnosticData.forEach((_, i) => {
          setTimeout(() => {
            const row = document.getElementById(`diag-row-${i}`);
            if (row) row.classList.add('active');
          }, i * 100);
        });
      }, 50);
    }

   

    function closeProgrammePopup() {
      location.href = 'synthes.html';
    }

    function backToDiag() {
      closeProgrammePopup();
      showCiblage();
    }


    function closeView() {
      document.getElementById('map-overlay').classList.remove('active');
      document.getElementById('map-detail').style.filter = "none";
      document.getElementById('isolated-box').classList.remove('active');
    }

    // --- MAP CORE ---

    function isolateGroup(zone) {
      zone === 'rural' ? showRuralLeft() : showUrbainLeft();
      document.getElementById('map-overlay').classList.add('active');
      document.getElementById('map-detail').style.filter = "blur(10px)";
      const svg = document.getElementById('isolated-svg');
      svg.innerHTML = "";
      let combinedBounds = null;

      // 1. Calculate Bounds
      Object.keys(layersMap).forEach(name => {
        const layer = layersMap[name];
        const bbox = layer._path.getBBox();
        if (!combinedBounds) combinedBounds = { x: bbox.x, y: bbox.y, r: bbox.x + bbox.width, b: bbox.y + bbox.height };
        else {
          combinedBounds.x = Math.min(combinedBounds.x, bbox.x); combinedBounds.y = Math.min(combinedBounds.y, bbox.y);
          combinedBounds.r = Math.max(combinedBounds.r, bbox.x + bbox.width); combinedBounds.b = Math.max(combinedBounds.b, bbox.y + bbox.height);
        }
      });

      // 2. Context shapes
      Object.keys(layersMap).forEach(name => {
        const layer = layersMap[name];
        const isTarget = (zone === 'rural' ? ruralNames.includes(name) : urbainNames.includes(name));
        if (!isTarget) {
          const ctx = document.createElementNS("http://www.w3.org/2000/svg", "path");
          ctx.setAttribute("d", layer._path.getAttribute('d'));
          ctx.setAttribute("fill", "#ffffff"); ctx.setAttribute("stroke", "#94a3b8"); ctx.setAttribute("stroke-width", "0.5");
          ctx.style.opacity = "0.7"; svg.appendChild(ctx);
        }
      });

      // 3. Target shapes
      Object.keys(layersMap).forEach(name => {
        const layer = layersMap[name];
        const isTarget = (zone === 'rural' ? ruralNames.includes(name) : urbainNames.includes(name));
        if (isTarget) {
          const bbox = layer._path.getBBox();
          const centerX = bbox.x + bbox.width / 2;
          const centerY = bbox.y + bbox.height / 2;

          const trace = document.createElementNS("http://www.w3.org/2000/svg", "path");
          trace.setAttribute("d", layer._path.getAttribute('d'));
          trace.setAttribute("fill", "#e2e8f0"); trace.setAttribute("stroke", "#94a3b8");
          trace.setAttribute("stroke-width", "0.5"); svg.appendChild(trace);

          const p = document.createElementNS("http://www.w3.org/2000/svg", "path");
          p.setAttribute("d", layer._path.getAttribute('d'));
          let pathColor = "var(--color-rural)";
          if (name === 'Tan-Tan' || name === 'El Ouatia') pathColor = "#a2466c";
          p.setAttribute("fill", pathColor);
          p.setAttribute("stroke", "#ffffff"); p.setAttribute("stroke-width", "1.5");
          p.setAttribute("id", `path-${name.replace(/\s+/g, '-')}`);
          p.setAttribute("class", "isolated-path");
          p.style.transformOrigin = `${centerX}px ${centerY}px`;
          svg.appendChild(p);

          const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
          t.setAttribute("x", centerX); t.setAttribute("y", centerY + 5); t.setAttribute("text-anchor", "middle");
          t.setAttribute("fill", "#000"); t.setAttribute("stroke", "#fff"); t.setAttribute("stroke-width", "3");
          t.setAttribute("paint-order", "stroke"); t.setAttribute("font-size", "11"); t.setAttribute("font-weight", "900");
          t.textContent = name; svg.appendChild(t);
        }
      });

      if (combinedBounds) svg.setAttribute('viewBox', `${combinedBounds.x - 20} ${combinedBounds.y - 20} ${combinedBounds.r - combinedBounds.x + 40} ${combinedBounds.b - combinedBounds.y + 40}`);
      document.getElementById('isolated-box').classList.add('active');
      setTimeout(() => { document.querySelectorAll('.isolated-path').forEach(p => p.classList.add('pop-active')); }, 100);
    }

    function closeView() {
      document.getElementById('map-overlay').classList.remove('active');
      document.getElementById('map-detail').style.filter = "none";
      document.getElementById('isolated-box').classList.remove('active');
      showDefaultProvinceData(); // Réaffiche les données au chargement après fermeture
      document.getElementById('panel-right').innerHTML = "";
      document.getElementById('sub-filter-urbain').style.display = 'none';
      map.fitBounds(group.getBounds(), { padding: [20, 20] });
    }

    function showSynthese(etape) {
      const body = document.getElementById('popup-body');
      const title = document.getElementById('popup-title');

      if (etape === 1) {
        title.innerText = "SYNTHÈSE DES CONTRAINTES ÉCONOMIQUES (1/2)";
        body.innerHTML = `
          <div class="ciblage-grid">
            <div class="ciblage-col">
              <!-- AGRICULTURE -->
              <div class="ciblage-title" style="background: #4a6741; animation-delay: 0.1s;">
                <i class="fa-solid fa-wheat-awn" style="margin-right: 10px;"></i> AGRICULTURE
              </div>
              <div class="diag-card diag-prob" style="animation-delay: 0.2s; border-left-color: #4a6741;">
                <div class="diag-icon" style="color: #4a6741; background: rgba(74, 103, 65, 0.1);"><i class="fa-solid fa-cloud-sun-rain"></i></div>
                <div class="diag-text">
                  <li>Rareté des ressources hydriques</li>
                  <li>Difficultés de financement</li>
                  <li>Pénurie de main d'œuvre qualifiée</li>
                  <li>Exode rural</li>
                </div>
              </div>

              <!-- TOURISME -->
              <div class="ciblage-title" style="background: #c25e23; animation-delay: 0.3s;">
                <i class="fa-solid fa-umbrella-beach" style="margin-right: 10px;"></i> TOURISME
              </div>
              <div class="diag-card diag-prob" style="animation-delay: 0.4s; border-left-color: #c25e23;">
                <div class="diag-icon" style="color: #c25e23; background: rgba(194, 94, 35, 0.1);"><i class="fa-solid fa-hotel"></i></div>
                <div class="diag-text">
                  <li>Faible capacité d'accueil</li>
                  <li>Faible valorisation des potentialités touristiques et du patrimoine culturel</li>
                </div>
              </div>

              <!-- ARTISANAT & ESS -->
              <div class="ciblage-title" style="background: #d4a017; animation-delay: 0.5s;">
                <i class="fa-solid fa-hand-holding-heart" style="margin-right: 10px;"></i> ARTISANAT & ESS
              </div>
              <div class="diag-card diag-target" style="animation-delay: 0.6s; border-left-color: #d4a017;">
                <div class="diag-icon" style="color: #d4a017; background: rgba(212, 160, 23, 0.1);"><i class="fa-solid fa-store"></i></div>
                <div class="diag-text">
                  <li>Faibles revenus</li>
                  <li>Difficultés de commercialisation</li>
                  <li>Difficultés d'accès au financement</li>
                  <li>Faibles actions d'encadrement</li>
                  <li>Faible utilisation des technologies numériques</li>
                </div>
              </div>
            </div>

            <div class="ciblage-col">
              <!-- PÊCHES MARITIMES -->
              <div class="ciblage-title" style="background: #2b5078; animation-delay: 0.1s;">
                <i class="fa-solid fa-ship" style="margin-right: 10px;"></i> PÊCHES MARITIMES
              </div>
              <div class="diag-card diag-prob" style="animation-delay: 0.2s; border-left-color: #2b5078;">
                <div class="diag-icon" style="color: #2b5078; background: rgba(43, 80, 120, 0.1);"><i class="fa-solid fa-fish-fins"></i></div>
                <div class="diag-text">
                  <li>Sur exploitation des ressources halieutiques </li>
                  <li>Faible valorisation des produits de la mer</li>
                  <li>Faible attractivité du secteur aquacole</li>
                </div>
              </div>

              <!-- ENTREPRENARIAT -->
              <div class="ciblage-title" style="background: #3d3d3d; animation-delay: 0.3s;">
                <i class="fa-solid fa-rocket" style="margin-right: 10px;"></i> ENTREPRENARIAT
              </div>
              <div class="diag-card diag-prob" style="animation-delay: 0.4s; border-left-color: #3d3d3d;">
                <div class="diag-icon" style="color: #3d3d3d; background: rgba(61, 61, 61, 0.1);"><i class="fa-solid fa-lightbulb"></i></div>
                <div class="diag-text">
                  <li>Difficultés d'accès au financement</li>
                  <li>Faible soutien au PME</li>
                  <li>Absence de structure d'appui et 'incubation</li>
                </div>
              </div>

              <!-- INDUSTRIE -->
              <div class="ciblage-title" style="background: #800080; animation-delay: 0.5s;">
                <i class="fa-solid fa-industry" style="margin-right: 10px;"></i> INDUSTRIE
              </div>
              <div class="diag-card diag-target" style="animation-delay: 0.6s; border-left-color: #800080;">
                <div class="diag-icon" style="color: #800080; background: rgba(128, 0, 128, 0.1);"><i class="fa-solid fa-gears"></i></div>
                <div class="diag-text">Manque de plateformes et zones industrielles</div>
              </div>
            </div>
          </div>
          <div style="text-align:right; margin-top:25px;">
            <button onclick="showSynthese(2)" class="btn-premium" style="background: #a2466c; padding: 12px 30px; font-size: 0.9rem;">
              Suivant <i class="fa-solid fa-arrow-right" style="margin-left: 10px;"></i>
            </button>
          </div>
        `;
      } else {
        title.innerText = "SYNTHÈSE DES POTENTIALITÉS & PROJETS (2/2)";
        body.innerHTML = `
          <div class="ciblage-grid">
            <div class="ciblage-col">
              <!-- ÉNERGIES VERTES -->
              <div class="ciblage-title" style="background: #2d3436; animation-delay: 0.1s;">
                <i class="fa-solid fa-bolt" style="margin-right: 10px;"></i> ÉNERGIES VERTES
              </div>
              <div class="diag-card diag-target" style="animation-delay: 0.2s; border-left-color: #2d3436;">
                <div class="diag-icon" style="color: #2d3436; background: rgba(45, 52, 54, 0.1);"><i class="fa-solid fa-leaf"></i></div>
                <div class="diag-text">Futur pôle de production et d'exportation de l'hydrogène vert. Nouveau port prévu.</div>
              </div>
              
              <!-- AGRICULTURE -->
              <div class="ciblage-title" style="background: #4a6741; animation-delay: 0.3s;">
                <i class="fa-solid fa-wheat-awn" style="margin-right: 10px;"></i> AGRICULTURE
              </div>
              <div class="diag-card diag-target" style="animation-delay: 0.4s; border-left-color: #4a6741;">
                <div class="diag-icon" style="color: #4a6741; background: rgba(74, 103, 65, 0.1);"><i class="fa-solid fa-faucet-drip"></i></div>
                <div class="diag-text">Station de dessalement prévue fin 2028 pour l'irrigation de 5000 Ha.</div>
              </div>

              <!-- INDUSTRIE -->
              <div class="ciblage-title" style="background: #800080; animation-delay: 0.5s;">
                <i class="fa-solid fa-industry" style="margin-right: 10px;"></i> INDUSTRIE
              </div>
              <div class="diag-card diag-target" style="animation-delay: 0.6s; border-left-color: #800080;">
                <div class="diag-icon" style="color: #800080; background: rgba(128, 0, 128, 0.1);"><i class="fa-solid fa-boxes-stacked"></i></div>
                <div class="diag-text">
                  <li>Secteur industriel lié aux activités de transformation des produits de la mer</li>
                  <li>Opportunités de développement d'autres filières</li>
                </div>
              </div>
           
              <!-- ARTISANAT & ESS -->
              <div class="ciblage-title" style="background: #d4a017; animation-delay: 0.7s;">
                <i class="fa-solid fa-hand-holding-heart" style="margin-right: 10px;"></i> ARTISANAT & ESS
              </div>
              <div class="diag-card diag-target" style="animation-delay: 0.8s; border-left-color: #d4a017;">
                <div class="diag-icon" style="color: #d4a017; background: rgba(212, 160, 23, 0.1);"><i class="fa-solid fa-palette"></i></div>
                <div class="diag-text">Savoir faire local et potentiel des produits de terroir importants.</div>
              </div>
            </div>

            <div class="ciblage-col">
              <!-- TOURISME -->
              <div class="ciblage-title" style="background: #c25e23; animation-delay: 0.1s;">
                <i class="fa-solid fa-umbrella-beach" style="margin-right: 10px;"></i> TOURISME
              </div>
              <div class="diag-card diag-target" style="animation-delay: 0.2s; border-left-color: #c25e23;">
                <div class="diag-icon" style="color: #c25e23; background: rgba(194, 94, 35, 0.1);"><i class="fa-solid fa-map-location-dot"></i></div>
                <div class="diag-text">
                  <li>Un littoral atlantique d’un linéaire de 98 km, ( plages, embouchures de oued Chbika, cap Daraa, …)</li>
                  <li>Paysage intérieur du Sahara riche et varié (oasis, grottes, sebkha, dunes)</li>
                  <li>Moussem de Tan-Tan inscrit par l'UNESCO en 2004 comme patrimoine immatériel de l'humanité.</li>
                </div>
              </div>
              
              <!-- PÊCHES MARITIMES -->
              <div class="ciblage-title" style="background: #2b5078; animation-delay: 0.3s;">
                <i class="fa-solid fa-ship" style="margin-right: 10px;"></i> PÊCHES MARITIMES
              </div>
              <div class="diag-card diag-target" style="animation-delay: 0.4s; border-left-color: #2b5078;">
                <div class="diag-icon" style="color: #2b5078; background: rgba(43, 80, 120, 0.1);"><i class="fa-solid fa-anchor"></i></div>
                <div class="diag-text">
                  <li>3ème port de pêche au niveau national</li>
                  <li>Potentiel halieutique important et diversifié</li>
                </div>
              </div>
            </div>
          </div>
          <div style="display: flex; justify-content: space-between; margin-top: 25px;">
            <button onclick="showSynthese(1)" class="btn-premium" style="background: #64748b; padding: 12px 30px; font-size: 0.9rem;">
              <i class="fa-solid fa-arrow-left" style="margin-right: 10px;"></i> Précédent
            </button>
            <button onclick="closePopupCiblage()" class="btn-premium" style="background: #a2466c; padding: 12px 30px; font-size: 0.9rem;">
              Fermer <i class="fa-solid fa-check" style="margin-left: 10px;"></i>
            </button>
          </div>
        `;
      }
      document.getElementById('alertPopup').style.display = 'flex';
    }

    const files = [{ f: "abteh.geojson", n: "Abteh" }, { f: "benkhlil.geojson", n: "Ben Khelil" }, { f: "chbika.geojson", n: "Chbika" }, { f: "commun tantan.geojson", n: "Tan-Tan" }, { f: "elouatia.geojson", n: "El Ouatia" }, { f: "msied.geojson", n: "Msied" }, { f: "tilemzoun.geojson", n: "Tilemzoun" }];
    const group = new L.FeatureGroup().addTo(map);
    files.forEach(item => {
      fetch(item.f).then(r => r.json()).then(data => {
        const l = L.geoJSON(data, {
          style: { color: "rgba(255,255,255,0.8)", weight: 2, fillColor: "#a2466c", fillOpacity: 0.15 }
        }).addTo(group);
        layersMap[item.n] = l.getLayers()[0];
        if (Object.keys(layersMap).length === files.length) {
          map.fitBounds(group.getBounds(), { padding: [50, 50] });
        }
      });
    });

    // --- POPUP GRAPHS ---

    function animateCounter(id, start, end, duration, decimals = 1, suffix = '') {
      const obj = document.getElementById(id);
      if (!obj) return;
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        const val = (progress * (end - start) + start).toFixed(decimals);
        obj.innerHTML = val + suffix;
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    }

    function showGraphPopup(type) {
      const modal = document.getElementById('alertPopup');
      const title = document.getElementById('popup-title');
      const body = document.getElementById('popup-body');
      const contentBox = document.getElementById('modal-content');

      contentBox.style.maxWidth = "950px";
      contentBox.style.width = "90%";
      document.querySelector('.modal-header').style.background = "var(--primary)";

      const bigGraphStyle = `
        <style>
            .big-chart-container {
                background: #fff;
                border-radius: 25px;
                padding: 40px;
                border: 2px solid #f1f5f9;
                overflow: hidden;
            }
            .big-chart-main {
                display: flex;
                justify-content: space-around;
                align-items: flex-end;
                height: 500px;
                border-bottom: 3px solid #e2e8f0;
                padding-bottom: 25px;
                gap: 20px;
                margin-top: 20px;
            }
            .big-bars-flex {
                display: flex;
                align-items: flex-end;
                gap: 20px;
            }
            .big-bar-wrapper {
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 120px;
                position: relative;
            }
            .big-bar {
                width: 65px;
                border-radius: 12px 12px 0 0;
                transition: height 1.8s cubic-bezier(0.16, 1, 0.3, 1);
                position: relative;
                box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
                height: 0;
            }
            .big-bar-value {
                font-size: 1.6rem;
                font-weight: 900;
                margin-bottom: 15px;
                color: #1e293b;
                text-align: center;
                opacity: 0;
                transition: opacity 0.6s ease-out;
                white-space: nowrap;
            }
            .big-cycle-label {
                font-size: 1.1rem;
                font-weight: 900;
                margin-top: 25px;
                color: #1e293b;
                text-transform: uppercase;
                text-align: center;
                letter-spacing: 1px;
                width: 100%;
                line-height: 1.2;
                min-height: 2.4em;
                display: flex;
                align-items: flex-start;
                justify-content: center;
            }
            .big-legend {
                display: flex;
                justify-content: center;
                gap: 40px;
                margin-bottom: 60px;
                font-size: 1.1rem;
                font-weight: 800;
                color: #475569;
            }
            .legend-pill-big {
                display: flex;
                align-items: center;
                gap: 12px;
            }
            .legend-color-big {
                width: 28px;
                height: 28px;
                border-radius: 8px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            }
            .big-circles-flex {
                display: flex;
                justify-content: space-around;
                gap: 30px;
                padding: 40px 0;
            }
            .big-circle-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            .big-circular-progress {
                position: relative;
                width: 160px;
                height: 160px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                background: #e2e8f0;
                transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            }
            .big-circular-progress::before {
                content: "";
                position: absolute;
                width: 130px;
                height: 130px;
                background: white;
                border-radius: 50%;
            }
            .big-circle-value {
                position: relative;
                font-weight: 950;
                font-size: 2rem;
                color: var(--primary);
                opacity: 0;
                transition: opacity 0.6s ease-out;
            }
            .big-circle-label {
                font-size: 1.3rem;
                font-weight: 900;
                color: #1e293b;
                text-transform: uppercase;
                letter-spacing: 1px;
            }
        </style>
      `;

      let graphHTML = "";

      if (type === 'secteurs') {
        title.innerHTML = "EMPLOIS SELON LES SECTEURS (%)";
        graphHTML = `
            ${bigGraphStyle}
            <div class="big-chart-container">
                <div class="big-circles-flex">
                    <div class="big-circle-item">
                        <div class="big-circular-progress" id="circ-1" style="background: conic-gradient(var(--primary) 0%, #e2e8f0 0)">
                            <span class="big-circle-value" id="val-1">0%</span>
                        </div>
                        <div class="big-circle-label">Commerce</div>
                    </div>
                    <div class="big-circle-item">
                        <div class="big-circular-progress" id="circ-2" style="background: conic-gradient(var(--primary) 0%, #e2e8f0 0)">
                            <span class="big-circle-value" id="val-2">0%</span>
                        </div>
                        <div class="big-circle-label">Services</div>
                    </div>
                    <div class="big-circle-item">
                        <div class="big-circular-progress" id="circ-3" style="background: conic-gradient(var(--primary) 0%, #e2e8f0 0)">
                            <span class="big-circle-value" id="val-3">0%</span>
                        </div>
                        <div class="big-circle-label">Industrie</div>
                    </div>
                    <div class="big-circle-item">
                        <div class="big-circular-progress" id="circ-4" style="background: conic-gradient(var(--primary) 0%, #e2e8f0 0)">
                            <span class="big-circle-value" id="val-4">0%</span>
                        </div>
                        <div class="big-circle-label">BTP</div>
                    </div>
                </div>
            </div>
        `;
      } else if (type === 'chomage-province') {
        title.innerHTML = "TAUX DE CHÔMAGE (%)";
        graphHTML = `
            ${bigGraphStyle}
            <div class="big-chart-container">
                <div class="big-legend">
                    <div class="legend-pill-big"><div class="legend-color-big" style="background:#94a3b8"></div> National</div>
                    <div class="legend-pill-big"><div class="legend-color-big" style="background:var(--accent)"></div> Région</div>
                    <div class="legend-pill-big"><div class="legend-color-big" style="background:var(--primary)"></div> Province</div>
                </div>
                <div class="big-chart-main" style="justify-content: center; gap: 80px;">
                    <div class="big-bar-wrapper">
                        <div class="big-bar-value" data-val="21.3">0%</div>
                        <div class="big-bar" data-target="210" style="background:#94a3b8"></div>
                        <div class="big-cycle-label">National</div>
                    </div>
                    <div class="big-bar-wrapper">
                        <div class="big-bar-value" data-val="31.5">0%</div>
                        <div class="big-bar" data-target="310" style="background:var(--accent)"></div>
                        <div class="big-cycle-label">Région</div>
                    </div>
                    <div class="big-bar-wrapper">
                        <div class="big-bar-value" data-val="25.3">0%</div>
                        <div class="big-bar" data-target="250" style="background:var(--primary)"></div>
                        <div class="big-cycle-label">Province</div>
                    </div>
                </div>
            </div>
        `;
      } else if (type === 'chomage-rural') {
        title.innerHTML = "TAUX DE CHÔMAGE MILIEU RURAL (%)";
        graphHTML = `
            ${bigGraphStyle}
            <div class="big-chart-container">
                <div class="big-legend">
                    <div class="legend-pill-big"><div class="legend-color-big" style="background:#94a3b8"></div> National</div>
                    <div class="legend-pill-big"><div class="legend-color-big" style="background:var(--accent)"></div> Région</div>
                    <div class="legend-pill-big"><div class="legend-color-big" style="background:var(--primary)"></div> Province</div>
                </div>
                <div class="big-chart-main" style="justify-content: center; gap: 80px;">
                    <div class="big-bar-wrapper">
                        <div class="big-bar-value" data-val="21.4">0%</div>
                        <div class="big-bar" data-target="210" style="background:#94a3b8"></div>
                        <div class="big-cycle-label">National</div>
                    </div>
                    <div class="big-bar-wrapper">
                        <div class="big-bar-value" data-val="38.2">0%</div>
                        <div class="big-bar" data-target="360" style="background:var(--accent)"></div>
                        <div class="big-cycle-label">Région</div>
                    </div>
                    <div class="big-bar-wrapper">
                        <div class="big-bar-value" data-val="28.7">0%</div>
                        <div class="big-bar" data-target="280" style="background:var(--primary)"></div>
                        <div class="big-cycle-label">Province</div>
                    </div>
                </div>
            </div>
        `;
      } else if (type === 'chomage-tantan') {
        title.innerHTML = "TAUX DE CHÔMAGE - VILLE TAN-TAN (%)";
        graphHTML = `
            ${bigGraphStyle}
            <div class="big-chart-container">
                <div class="big-legend">
                    <div class="legend-pill-big"><div class="legend-color-big" style="background:#94a3b8"></div> National</div>
                    <div class="legend-pill-big"><div class="legend-color-big" style="background:var(--accent)"></div> Province</div>
                    <div class="legend-pill-big"><div class="legend-color-big" style="background:var(--primary)"></div> Ville</div>
                </div>
                <div class="big-chart-main" style="justify-content: center; gap: 80px;">
                    <div class="big-bar-wrapper">
                        <div class="big-bar-value" data-val="21.2">0%</div>
                        <div class="big-bar" data-target="210" style="background:#94a3b8"></div>
                        <div class="big-cycle-label">National</div>
                    </div>
                    <div class="big-bar-wrapper">
                        <div class="big-bar-value" data-val="25.2">0%</div>
                        <div class="big-bar" data-target="250" style="background:var(--accent)"></div>
                        <div class="big-cycle-label">Province</div>
                    </div>
                    <div class="big-bar-wrapper">
                        <div class="big-bar-value" data-val="28.0">0%</div>
                        <div class="big-bar" data-target="280" style="background:var(--primary)"></div>
                        <div class="big-cycle-label">Ville Tan-Tan</div>
                    </div>
                </div>
            </div>
        `;
      } else if (type === 'chomage-elouatia') {
        title.innerHTML = "TAUX DE CHÔMAGE - EL OUATIA (%)";
        graphHTML = `
            ${bigGraphStyle}
            <div class="big-chart-container">
                <div class="big-legend">
                    <div class="legend-pill-big"><div class="legend-color-big" style="background:#94a3b8"></div> Nat.</div>
                    <div class="legend-pill-big"><div class="legend-color-big" style="background:var(--accent)"></div> Région</div>
                    <div class="legend-pill-big"><div class="legend-color-big" style="background:#72a8d3"></div> Prov.</div>
                    <div class="legend-pill-big"><div class="legend-color-big" style="background:var(--primary)"></div> Ville</div>
                </div>
                <div class="big-chart-main" style="justify-content: center; gap: 40px;">
                    <div class="big-bar-wrapper">
                        <div class="big-bar-value" data-val="21.2">0%</div>
                        <div class="big-bar" data-target="210" style="background:#94a3b8"></div>
                        <div class="big-cycle-label">National</div>
                    </div>
                    <div class="big-bar-wrapper">
                        <div class="big-bar-value" data-val="29.2">0%</div>
                        <div class="big-bar" data-target="290" style="background:var(--accent)"></div>
                        <div class="big-cycle-label">Région</div>
                    </div>
                    <div class="big-bar-wrapper">
                        <div class="big-bar-value" data-val="25.2">0%</div>
                        <div class="big-bar" data-target="250" style="background:#72a8d3"></div>
                        <div class="big-cycle-label">Province</div>
                    </div>
                    <div class="big-bar-wrapper">
                        <div class="big-bar-value" data-val="11.1">0%</div>
                        <div class="big-bar" data-target="110" style="background:var(--primary)"></div>
                        <div class="big-cycle-label">El Ouatia</div>
                    </div>
                </div>
            </div>
        `;
      }

      body.innerHTML = graphHTML;
      modal.style.display = 'flex';

      // Animation Trigger
      if (type === 'secteurs') {
        const valData = [45, 29, 22, 4];
        valData.forEach((val, i) => {
          setTimeout(() => {
            const circle = document.getElementById(`circ-${i + 1}`);
            const valSpan = document.getElementById(`val-${i + 1}`);
            circle.style.background = `conic-gradient(var(--primary) ${val}%, #e2e8f0 0)`;
            valSpan.style.opacity = "1";
            animateCounter(`val-${i + 1}`, 0, val, 1500, 1, '%');
          }, i * 250);
        });
      } else {
        const bars = body.querySelectorAll('.big-bar');
        const values = body.querySelectorAll('.big-bar-value');

        bars.forEach((bar, index) => {
          setTimeout(() => {
            bar.style.height = bar.getAttribute('data-target') + 'px';
            values[index].style.opacity = '1';
            const targetVal = parseFloat(values[index].getAttribute('data-val'));
            const uniqueId = 'c-v-' + index;
            values[index].id = uniqueId;
            animateCounter(uniqueId, 0, targetVal, 1500, 1, '%');
          }, index * 200);
        });
      }
    }

    function closePopupCiblage() {
      const modal = document.getElementById('modal-content');
      modal.style.transform = 'scale(0.9)';
      modal.style.opacity = '0';

      setTimeout(() => {
        document.getElementById('alertPopup').style.display = 'none';
        modal.style.transform = 'scale(1)';
        modal.style.opacity = '1';
        // reset if needed, but not necessarily needed if we redraw data
      }, 300);
    }
  </script>
</body>

</html>